import{d as k,c as l,o as i,a as t,F as x,g as h,h as c,m as y,t as a,v}from"./index-DREjU6--.js";const U={class:"table table-sm align-middle"},N=["onUpdate:modelValue","onChange"],$=["value"],P=["onUpdate:modelValue"],q=["onUpdate:modelValue"],w=["onUpdate:modelValue"],C=["onUpdate:modelValue"],F=["value"],T={class:"text-end"},A={class:"text-end"},M=["onClick"],D={class:"d-flex align-items-start mt-2"},S={class:"ms-auto text-end"},B={class:"badge text-bg-light border d-block mb-1"},L={class:"badge text-bg-light border d-block mb-1"},E={class:"badge text-bg-light border d-block"},R={__name:"LineItemsEditor",props:{items:{type:Array,required:!0},products:{type:Array,required:!0},taxes:{type:Array,required:!0}},emits:["update"],setup(m,{expose:f,emit:g}){const r=m,b=g;function I(){r.items.push({id:Math.random().toString(36).slice(2,9),productId:"",description:"",qty:1,unitPrice:0,taxId:""}),b("update")}function _(s){r.items.splice(s,1),b("update")}function V(s){const o=r.products.find(n=>n.id===s.productId);if(o){s.description=o.name;const n=Number(o.price)||0,d=o.discountType||"none",e=Number(o.discountValue)||0;let u=n;d==="fixed"?u=Math.max(0,n-e):d==="percent"&&(u=Math.max(0,n*(1-e/100))),s.unitPrice=Number(u.toFixed(2)),o.taxId&&(s.taxId=o.taxId)}b("update")}const p=k(()=>{let s=0,o=0;for(const n of r.items){const d=(Number(n.qty)||0)*(Number(n.unitPrice)||0);s+=d;const e=r.taxes.find(u=>u.id===n.taxId);e&&(o+=d*(Number(e.rate)||0)/100)}return{sub:s,tax:o,total:s+o}});return f({totals:p}),(s,o)=>(i(),l("div",null,[t("table",U,[o[6]||(o[6]=t("thead",{class:"table-light"},[t("tr",null,[t("th",{style:{width:"26%"}},"Product"),t("th",null,"Description"),t("th",{style:{width:"10%"},class:"text-end"},"Qty"),t("th",{style:{width:"14%"},class:"text-end"},"Unit Price"),t("th",{style:{width:"16%"}},"Tax"),t("th",{style:{width:"14%"},class:"text-end"},"Line Total"),t("th",{style:{width:"8%"}})])],-1)),t("tbody",null,[(i(!0),l(x,null,h(m.items,(n,d)=>(i(),l("tr",{key:n.id},[t("td",null,[c(t("select",{class:"form-select form-select-sm","onUpdate:modelValue":e=>n.productId=e,onChange:e=>V(n)},[o[4]||(o[4]=t("option",{value:""},"â€”",-1)),(i(!0),l(x,null,h(m.products,e=>(i(),l("option",{key:e.id,value:e.id},a(e.name),9,$))),128))],40,N),[[y,n.productId]])]),t("td",null,[c(t("input",{class:"form-control form-control-sm","onUpdate:modelValue":e=>n.description=e,placeholder:"Description",onInput:o[0]||(o[0]=e=>s.$emit("update"))},null,40,P),[[v,n.description]])]),t("td",null,[c(t("input",{class:"form-control form-control-sm text-end",type:"number",min:"0",step:"1","onUpdate:modelValue":e=>n.qty=e,onInput:o[1]||(o[1]=e=>s.$emit("update"))},null,40,q),[[v,n.qty,void 0,{number:!0}]])]),t("td",null,[c(t("input",{class:"form-control form-control-sm text-end",type:"number",min:"0",step:"0.01","onUpdate:modelValue":e=>n.unitPrice=e,onInput:o[2]||(o[2]=e=>s.$emit("update"))},null,40,w),[[v,n.unitPrice,void 0,{number:!0}]])]),t("td",null,[c(t("select",{class:"form-select form-select-sm","onUpdate:modelValue":e=>n.taxId=e,onChange:o[3]||(o[3]=e=>s.$emit("update"))},[o[5]||(o[5]=t("option",{value:""},"None",-1)),(i(!0),l(x,null,h(m.taxes,e=>(i(),l("option",{key:e.id,value:e.id},a(e.name)+" ("+a(e.rate)+"%)",9,F))),128))],40,C),[[y,n.taxId]])]),t("td",T,a(((Number(n.qty)||0)*(Number(n.unitPrice)||0)).toFixed(2)),1),t("td",A,[t("button",{class:"btn btn-sm btn-outline-danger",type:"button",onClick:e=>_(d)},"Remove",8,M)])]))),128))])]),t("div",D,[t("button",{class:"btn btn-sm btn-outline-secondary",type:"button",onClick:I},"+ Add line"),t("div",S,[t("div",B,"Subtotal: "+a(p.value.sub.toFixed(2)),1),t("div",L,"Tax: "+a(p.value.tax.toFixed(2)),1),t("div",E,"Total: "+a(p.value.total.toFixed(2)),1)])])]))}};export{R as _};
