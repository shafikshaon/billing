var se=(ie,O,s)=>new Promise((K,A)=>{var X=F=>{try{k(s.next(F))}catch(w){A(w)}},W=F=>{try{k(s.throw(F))}catch(w){A(w)}},k=F=>F.done?K(F.value):Promise.resolve(F.value).then(X,W);k((s=s.apply(ie,O)).next())});import{r as Oe,b as Ne,u as Le,v as Re,z as Be,d as g,w as J,e as a,o as d,f as t,p as ne,l as Fe,x as I,y as j,j as v,F as N,g as $,m as E,t as i,A as P,B as oe,C as B}from"./vendor-iuljl24U.js";import{S as Te}from"./SectionCard-Cl3nWDUi.js";import{_ as He}from"./LineItemsEditor-BJs9WVh7.js";import{s as c,u as Je,b as Xe}from"./index-FBZ1k241.js";const Ye={class:"row g-3"},Qe={class:"col-lg-6"},Ge={class:"row g-3"},Ke={class:"col-md-4"},We={class:"d-flex gap-2"},Ze={class:"col-md-4"},et={class:"col-md-4"},tt={class:"col-md-6"},st=["disabled"],nt=["value"],ot={key:0,class:"row g-2 mt-1"},it={class:"col-7"},lt=["value"],at={class:"col-5"},dt=["value"],rt={key:1,class:"form-text"},ut={class:"col-md-6"},mt=["disabled"],ct=["value"],pt={key:0,class:"row g-2 mt-1"},vt={class:"col-7"},bt=["value"],ft={class:"col-5"},xt=["value"],ht={key:1,class:"form-text"},gt={class:"col-md-6"},yt=["value"],It={class:"col-md-6"},_t=["value"],wt={class:"col-md-6"},kt=["value"],Nt={key:0,class:"mt-2"},Ft={class:"row g-2"},Tt={class:"col-6"},At={class:"form-text"},St={class:"col-6 d-flex align-items-end gap-3"},$t={class:"form-check form-switch"},Dt={class:"form-check"},Ct={class:"form-text"},Mt={class:"col-12"},Vt={class:"row g-2 align-items-end"},Pt={class:"col-sm-4"},Ut=["disabled"],zt={class:"col-sm-4"},qt=["disabled"],jt={class:"col-sm-4"},Et={class:"form-check mt-4"},Ot={class:"col-12"},Lt={class:"col-12"},Rt={class:"form-sticky-actions mt-3"},Bt={class:"d-flex flex-wrap align-items-center justify-content-between gap-2 p-2"},Ht={class:"d-flex align-items-center gap-2 flex-wrap"},Jt={class:"badge"},Xt={class:"badge"},Yt={class:"badge"},Qt={class:"badge"},Gt={class:"badge"},Kt={class:"badge"},Wt={class:"d-flex gap-2"},Zt={class:"col-lg-6"},es={class:"invoice-header d-flex justify-content-between align-items-start border-bottom pb-2 mb-3"},ts={class:"invoice-brand"},ss={key:0},ns={key:1},os={key:2,class:"text-muted small"},is={key:3},ls={key:4,class:"text-muted small"},as={key:0},ds={key:1},rs={class:"text-end"},us={class:"mb-2 info-block"},ms={class:"fw-semibold"},cs={key:0},ps={key:1,class:"text-muted small"},vs={key:2,class:"text-muted small"},bs={key:0},fs={key:1},xs={class:"table table-sm table-invoice align-middle mt-2"},hs={class:"fw-medium"},gs={key:0,class:"text-muted small"},ys={class:"text-end"},Is={class:"text-end"},_s={class:"text-end"},ws={key:0},ks={key:1},Ns={key:2},Fs={class:"text-end"},Ts={key:0},As={class:"mt-2 d-flex"},Ss={class:"totals-card"},$s={class:"line"},Ds={class:"line"},Cs={class:"line"},Ms={class:"text-decoration-line-through"},Vs={class:"line grand"},Ps={key:0,class:"line"},Us={key:1,class:"line"},zs={key:2,class:"line"},qs={key:3,class:"line"},js={class:"fw-semibold"},Es={key:4,class:"muted small mt-1"},Os={key:0,class:"mt-2"},Ls={class:"table table-sm mt-1"},Rs={class:"text-end"},Bs={key:1,class:"mt-3"},Hs={style:{"white-space":"pre-wrap"}},Js={key:2,class:"mt-2"},Xs={style:{"white-space":"pre-wrap"}},Zs={__name:"Invoices",setup(ie){var he,ge,ye,Ie,_e,we;const O=()=>new Date().toISOString().slice(0,10),s=Oe({id:"",number:"",date:O(),dueDate:O(),merchantId:"",merchantAddressId:"",merchantContactId:"",customerId:"",customerAddressId:"",customerContactId:"",paymentTermId:((ge=(he=c.settings)==null?void 0:he.invoice)==null?void 0:ge.defaultPaymentTermId)||"",termsTemplateId:((Ie=(ye=c.settings)==null?void 0:ye.invoice)==null?void 0:Ie.defaultTermsTemplateId)||"",shippingMethodId:((we=(_e=c.settings)==null?void 0:_e.invoice)==null?void 0:we.defaultShippingMethodId)||"",shippingAmount:0,shippingCod:!1,shippingFree:!1,shippingFee:0,receivedAmount:0,changeAmount:0,paidInFull:!1,notes:"",items:[]}),K=Ne(null),A=Ne(null),X=Le(),W=Re(),k=Xe();Be(()=>{if(X.params.id){const n=c.invoices.find(e=>e.id===X.params.id);n&&Object.assign(s,JSON.parse(JSON.stringify(n)))}s.merchantId&&!s.merchantAddressId&&ue(),s.customerId&&!s.customerAddressId&&me()});function F(n){return c.products.find(e=>e.id===n)}const w=g(()=>c.merchants.find(n=>n.id===s.merchantId)),le=g(()=>{var n;return((n=w.value)==null?void 0:n.addresses)||[]}),ae=g(()=>{var n;return((n=w.value)==null?void 0:n.contacts)||[]}),D=g(()=>le.value.find(n=>n.id===s.merchantAddressId)),z=g(()=>ae.value.find(n=>n.id===s.merchantContactId)),C=g(()=>c.customers.find(n=>n.id===s.customerId)),de=g(()=>{var n;return((n=C.value)==null?void 0:n.addresses)||[]}),re=g(()=>{var n;return((n=C.value)==null?void 0:n.contacts)||[]}),U=g(()=>de.value.find(n=>n.id===s.customerAddressId)),q=g(()=>re.value.find(n=>n.id===s.customerContactId));function ue(){var e,l,r,u,o,m,h,y;const n=w.value;n&&(s.merchantAddressId=((l=(e=n.addresses)==null?void 0:e.find(f=>f.type==="primary"))==null?void 0:l.id)||((u=(r=n.addresses)==null?void 0:r[0])==null?void 0:u.id)||"",s.merchantContactId=((m=(o=n.contacts)==null?void 0:o.find(f=>f.type==="primary"))==null?void 0:m.id)||((y=(h=n.contacts)==null?void 0:h[0])==null?void 0:y.id)||"")}function me(){var e,l,r,u,o,m,h,y;const n=C.value;n&&(s.customerAddressId=((l=(e=n.addresses)==null?void 0:e.find(f=>f.type==="primary"))==null?void 0:l.id)||((u=(r=n.addresses)==null?void 0:r[0])==null?void 0:u.id)||"",s.customerContactId=((m=(o=n.contacts)==null?void 0:o.find(f=>f.type==="primary"))==null?void 0:m.id)||((y=(h=n.contacts)==null?void 0:h[0])==null?void 0:y.id)||"")}J(()=>s.merchantId,()=>ue()),J(()=>s.customerId,()=>me());const ce=g(()=>{var n;return((n=c.termsTemplates.find(e=>e.id===s.termsTemplateId))==null?void 0:n.content)||""}),Y=g(()=>c.paymentTerms.find(n=>n.id===s.paymentTermId));function H(n){const e=(Number(n.qty)||0)*(Number(n.unitPrice)||0),l=n.discountType||"none",r=Number(n.discountValue)||0,u=l==="percent"?e*r/100:l==="fixed"?(Number(n.qty)||0)*r:0;return Math.max(0,e-u)}const b=g(()=>{let n=0,e=0;for(const r of s.items){const u=H(r);n+=u;const o=c.taxes.find(m=>m.id===r.taxId);o&&(e+=u*(Number(o.rate)||0)/100)}const l=pe.value;return{sub:n,tax:e,shipping:l,total:n+e+l}});function Ae(n){return(n.items||[]).reduce((l,r)=>{const u=(Number(r.qty)||0)*(Number(r.unitPrice)||0),o=r.discountType||"none",m=Number(r.discountValue)||0,h=o==="percent"?u*m/100:o==="fixed"?(Number(r.qty)||0)*m:0,y=Math.max(0,u-h),f=(()=>{const V=c.taxes.find(p=>p.id===r.taxId);return V?y*(Number(V.rate)||0)/100:0})();return l+y+f},0)}const Se=g(()=>(c.creditNotes||[]).filter(n=>!!s.id&&n.originalInvoiceId===s.id&&(n.status==="issued"||n.status==="applied"))),M=g(()=>Se.value.reduce((n,e)=>n+Ae(e),0)),$e=g(()=>{var e,l,r;const n=(((r=(l=(e=C.value)==null?void 0:e.addresses)==null?void 0:l[0])==null?void 0:r.city)||"").toLowerCase();return n?n.includes("dhaka")?"inside_dhaka":"outside_dhaka":"any"}),De=g(()=>{const n=$e.value;return c.shippingMethods.filter(e=>e.region==="any"||e.region===n)}),T=g(()=>c.shippingMethods.find(n=>n.id===s.shippingMethodId));function Z(n){if(!n)return 0;const e=Ce.value.sub;return n.freeThreshold&&e>=Number(n.freeThreshold)?0:n.chargeType==="percent"?Number((e*(Number(n.amount)||0)/100).toFixed(2)):Number(n.amount)||0}const pe=g(()=>{var l;if(!T.value)return 0;const e=Number((l=s.shippingAmount)!=null?l:0);return s.shippingFree?0:e});J(()=>s.shippingMethodId,()=>{const n=T.value;n?(s.shippingAmount=Z(n),s.shippingCod=!!n.codAvailable,s.shippingFree=!1):(s.shippingAmount=0,s.shippingCod=!1,s.shippingFree=!1)}),J([()=>s.paidInFull,b],()=>{s.paidInFull&&(s.receivedAmount=Number(b.value.total||0),s.changeAmount=0)});const Ce=g(()=>{let n=0,e=0;for(const l of s.items){const r=H(l);n+=r;const u=c.taxes.find(o=>o.id===l.taxId);u&&(e+=r*(Number(u.rate)||0)/100)}return{sub:n,tax:e,total:n+e}});function ve(n){const[e,l,r]=n.split("-").map(Number);return new Date(e,l-1,r)}function be(n){const e=n.getFullYear(),l=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0");return`${e}-${l}-${r}`}function fe(n,e){const l=ve(n);return l.setDate(l.getDate()+(Number(e)||0)),be(l)}function Me(n,e){const l=ve(n),r=l.getFullYear(),u=l.getMonth(),o=new Date(r,u+1,Math.min(Number(e)||1,31)),m=new Date(o.getFullYear(),o.getMonth()+1,0).getDate();return o.setDate(Math.min(Number(e)||1,m)),be(o)}const ee=g(()=>{const n=Y.value,e=s.date,l=b.value.total;if(!n||!e)return[];const r=(n.schedule||[]).slice().sort((m,h)=>(m.sequence||0)-(h.sequence||0));let u=l;const o=r.map((m,h)=>{const y=m.dateType==="day_of_month"?Me(e,m.dayOfMonth||1):fe(e,m.days||0);let f=0;return m.valueType==="percent"?f=l*(Number(m.valueAmount)||0)/100:f=Number(m.valueAmount)||0,h===r.length-1&&(f=u),u=Math.max(0,u-f),{label:m.description||`Installment ${h+1}`,date:y,amount:f}});return o.length?o:[{label:"Due",date:fe(e,0),amount:l}]}),Ve=g(()=>{let n=s.date;for(const e of ee.value)e.date&&e.date>n&&(n=e.date);return n});function Pe(){var n,e;Object.assign(s,{id:"",number:"",date:O(),dueDate:O(),merchantId:"",customerId:"",paymentTermId:((n=c.paymentTerms[0])==null?void 0:n.id)||"",termsTemplateId:((e=c.termsTemplates[0])==null?void 0:e.id)||"",notes:"",items:[]})}J([()=>s.date,()=>s.paymentTermId,b],()=>{s.dueDate=Ve.value});function xe(){var l;const n=((l=c.settings)==null?void 0:l.invoice)||{prefix:"INV-",nextNumber:1,zeroPad:0},e=String(n.nextNumber).padStart(Number(n.zeroPad)||0,"0");s.number=`${n.prefix||""}${e}`,n.nextNumber=Number(n.nextNumber||1)+1}function Ue(){var n,e;if(!s.number&&!((e=(n=c.settings)==null?void 0:n.invoice)!=null&&e.autoNumberOnSave))return k.error("Validation Error","Invoice number is required"),!1;if(!s.date)return k.error("Validation Error","Invoice date is required"),!1;if(!s.dueDate)return k.error("Validation Error","Due date is required"),!1;if(!s.merchantId)return k.error("Validation Error","Please select a merchant"),!1;if(!s.customerId)return k.error("Validation Error","Please select a customer"),!1;if(!s.items||s.items.length===0)return k.error("Validation Error","At least one line item is required"),!1;for(let l=0;l<s.items.length;l++){const r=s.items[l];if(!r.productId&&!r.description)return k.error("Validation Error",`Line item ${l+1}: Product or description is required`),!1;if(!r.qty||Number(r.qty)<=0)return k.error("Validation Error",`Line item ${l+1}: Quantity must be greater than 0`),!1}return!0}function ze(){var l,r;if(!Ue())return;!s.number&&((r=(l=c.settings)==null?void 0:l.invoice)!=null&&r.autoNumberOnSave)&&xe(),s.id||(s.id=Je("inv_")),s.shippingFee=pe.value;const n=JSON.parse(JSON.stringify(s)),e=c.invoices.findIndex(u=>u.id===n.id);e===-1?c.invoices.push(n):c.invoices.splice(e,1,n),k.success("Saved","Invoice saved successfully")}function qe(){if(!(A!=null&&A.value))return;const n=A.value.outerHTML,e=window.open("","_blank","noopener,noreferrer");e&&(e.document.write(`
    <html>
      <head>
        <meta charset="utf-8"/>
        <title>${s.number||"Invoice"}</title>
        <link rel="stylesheet" href="https://bootswatch.com/5/pulse/bootstrap.min.css"/>
        <style>
          @page { size: A4; margin: 10mm; }
          body { background:#fff; -webkit-print-color-adjust: exact; print-color-adjust: exact; margin: 0; }
          .print-area { width: 190mm; margin: 0 auto; padding: 10mm; border: none; }
          .print-area h4 { font-size: 20px; color: #4a148c; }
          .print-area table { font-size: 12px; }
        </style>
      </head>
      <body>
        ${n}
        <script>
          window.addEventListener('load', function(){
            setTimeout(function(){
              try { window.focus(); window.print(); } finally { window.close(); }
            }, 150);
          });
        <\/script>
      </body>
    </html>
  `),e.document.close())}function je(){const n=w.value,e=C.value,l=T.value,r=Number(((M==null?void 0:M.value)||0).toFixed(2)),u=Number(b.value.sub.toFixed(2)),o=Number(b.value.tax.toFixed(2)),m=Number(b.value.shipping.toFixed(2)),h=Number(b.value.total.toFixed(2)),y=Number(s.paidInFull?h:Number(s.receivedAmount||0)-Number(s.changeAmount||0)),f=Math.max(0,h-r-y),V=(s.items||[]).map(S=>{var x;const L=((x=F(S.productId))==null?void 0:x.name)||S.description||"—",te=Number(S.qty||0),Q=Number(S.unitPrice||0).toFixed(2),G=Number(H(S).toFixed(2));return`
      <div class="row">
        <div class="name">${L}</div>
        <div class="meta">${te} x ${Q} = ${G.toFixed(2)}</div>
      </div>
    `}).join(""),p=window.open("","_blank","noopener,noreferrer");p&&(p.document.write(`
    <html>
      <head>
        <meta charset="utf-8"/>
        <title>Receipt ${s.number||""}</title>
        <style>
          @page { size: 80mm auto; margin: 0; }
          html, body { padding:0; margin:0; }
          body { -webkit-print-color-adjust: exact; print-color-adjust: exact; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; }
          .receipt { width: 72mm; padding: 4mm 4mm 8mm; }
          .center { text-align:center; }
          .muted { color:#555; }
          .row { margin: 2px 0; }
          .name { font-size: 12px; }
          .meta { font-size: 11px; color:#444; display:flex; justify-content: space-between; }
          .hr { border-top: 1px dashed #000; margin: 6px 0; }
          .totals .line { display:flex; justify-content: space-between; font-size: 12px; }
          .totals .grand { font-weight: 700; }
          .small { font-size: 10px; }
        </style>
      </head>
      <body>
        <div class="receipt">
          <div class="center">
            <div style="font-weight:700">${(n==null?void 0:n.name)||""}</div>
            <div class="small muted">${D!=null&&D.value?D.value.line1+", "+D.value.city:""}</div>
            <div class="small">Invoice: ${s.number||""}</div>
            <div class="small">Date: ${s.date||""}</div>
          </div>

          <div class="hr"></div>

          <div class="small">Customer: ${(e==null?void 0:e.name)||""}</div>
          ${U!=null&&U.value?`<div class="small muted">${U.value.city}</div>`:""}

          <div class="hr"></div>

          ${V||'<div class="small muted">No items</div>'}

          <div class="hr"></div>

          <div class="totals">
            <div class="line"><span>Subtotal</span><span>${u.toFixed(2)}</span></div>
            <div class="line"><span>Tax</span><span>${o.toFixed(2)}</span></div>
            ${m>0?`<div class="line"><span>Shipping</span><span>${m.toFixed(2)}</span></div>`:""}
            <div class="line grand"><span>Total</span><span>${h.toFixed(2)}</span></div>
            ${r>0?`<div class="line"><span>Credits</span><span>-${r.toFixed(2)}</span></div>`:""}
            <div class="line"><span>Received</span><span>${y.toFixed(2)}</span></div>
            <div class="line"><span>Balance</span><span>${f.toFixed(2)}</span></div>
          </div>

          ${l?`<div class="small muted" style="margin-top:6px">Shipping via ${l.name}</div>`:""}

          <div class="center small" style="margin-top:8px">— Thank you —</div>
        </div>

        <script>
          window.addEventListener('load', function(){
            setTimeout(function(){
              try { window.focus(); window.print(); } finally { window.close(); }
            }, 150);
          });
        <\/script>
      </body>
    </html>
  `),p.document.close())}function Ee(){return se(this,null,function*(){var Q,G;if(!(A!=null&&A.value))return;function n(){return se(this,null,function*(){return window.pdfMake||(yield new Promise((x,R)=>{const _=document.createElement("script");_.src="https://cdn.jsdelivr.net/npm/pdfmake@0.2.10/build/pdfmake.min.js",_.onload=x,_.onerror=R,document.body.appendChild(_)}),yield new Promise((x,R)=>{const _=document.createElement("script");_.src="https://cdn.jsdelivr.net/npm/pdfmake@0.2.10/build/vfs_fonts.min.js",_.onload=x,_.onerror=R,document.body.appendChild(_)})),window.pdfMake})}yield n();const e=w.value,l=C.value,r=D.value,u=U.value,o=z.value,m=q.value,h=ee.value.map(x=>[x.label,x.date,{text:x.amount.toFixed(2),alignment:"right"}]),y=Number(s.receivedAmount||0),f=Number(s.changeAmount||0),V=s.paidInFull?b.value.total||0:Math.max(0,y-f),p=Math.max(0,(b.value.total||0)-V),S=(((Q=c.termsTemplates.find(x=>x.id===s.termsTemplateId))==null?void 0:Q.content)||"").trim(),L=[[{text:"Product / Description",bold:!0},{text:"Qty",alignment:"right",bold:!0},{text:"Unit",alignment:"right",bold:!0},{text:"Discount",alignment:"right",bold:!0},{text:"Line",alignment:"right",bold:!0}],...s.items.map(x=>{var _;const R=(x.discountType||"none")==="percent"?`-${Number(x.discountValue||0).toFixed(0)}%`:(x.discountType||"none")==="fixed"?`- ${(Number(x.discountValue||0)*Number(x.qty||0)).toFixed(2)}`:"—";return[((_=F(x.productId))==null?void 0:_.name)||x.description||"—",{text:String(x.qty||0),alignment:"right"},{text:Number(x.unitPrice||0).toFixed(2),alignment:"right"},{text:R,alignment:"right"},{text:H(x).toFixed(2),alignment:"right"}]})],te={pageSize:"A4",pageMargins:[28,28,28,28],content:[{columns:[[{text:"Invoice",style:"title"},{text:`No: ${s.number||"(not set)"}`},{text:`Date: ${s.date}`},{text:`Due: ${s.dueDate}`}],[{text:(e==null?void 0:e.name)||"Select Merchant",alignment:"right",bold:!0},{text:r?`${r.line1}, ${r.city}`:"",alignment:"right"},e!=null&&e.taxId?{text:`VAT/TAX ID: ${e.taxId}`,alignment:"right",color:"#6c757d",fontSize:9}:{},o?{text:`${o.name}${o.email?" · "+o.email:""}${o.phone?" · "+o.phone:""}`,alignment:"right",color:"#6c757d",fontSize:9}:{}]]},{text:" ",margin:[0,6]},{text:"Bill To",bold:!0},{text:(l==null?void 0:l.name)||"Select Customer"},{text:u?`${u.line1}, ${u.city}`:""},l!=null&&l.taxId?{text:`VAT/TAX ID: ${l.taxId}`,color:"#6c757d",fontSize:9}:{},m?{text:`${m.name}${m.email?" · "+m.email:""}${m.phone?" · "+m.phone:""}`,color:"#6c757d",fontSize:9}:{},{text:" ",margin:[0,6]},{table:{headerRows:1,widths:["*",40,50,55,60],body:L},layout:"lightHorizontalLines"},{columns:[{text:" "},{width:200,alignment:"right",stack:[{text:`Subtotal: ${b.value.sub.toFixed(2)}`},{text:`Tax: ${b.value.tax.toFixed(2)}`},s.shippingFree?{text:["Shipping: 0.00 ",{text:`(was ${Number(s.shippingAmount||0).toFixed(2)})`,decoration:"lineThrough"}]}:{text:`Shipping: ${(b.value.shipping||0).toFixed(2)}`},{text:`Total: ${b.value.total.toFixed(2)}`,bold:!0},s.paidInFull||y>0?{text:`Received: ${y.toFixed(2)}`}:{},f>0?{text:`Change: ${f.toFixed(2)}`}:{},s.paidInFull||y>0?{text:`Balance Due: ${p.toFixed(2)}`,bold:!0}:{}]}],margin:[0,8,0,0]},...h.length&&!s.paidInFull?[{text:`Payment Schedule — ${((G=Y.value)==null?void 0:G.name)||""}`,bold:!0,margin:[0,8,0,4]},{table:{headerRows:1,widths:["*",80,80],body:[[{text:"Installment",bold:!0},{text:"Date",bold:!0},{text:"Amount",alignment:"right",bold:!0}],...h]},layout:"lightHorizontalLines"}]:[],...S?[{text:"Terms",bold:!0,margin:[0,12,0,4]},{text:S,fontSize:9}]:[]],footer:(x,R)=>{var _,ke;return{margin:[28,8,28,16],fontSize:9,text:((ke=(_=c.settings)==null?void 0:_.invoice)==null?void 0:ke.footerText)||""}},styles:{title:{fontSize:18,color:"#4a148c",bold:!0}},defaultStyle:{fontSize:10}};window.pdfMake.createPdf(te).download(`invoice_${s.number||"draft"}.pdf`)})}return(n,e)=>(d(),a("div",Ye,[t("div",Qe,[ne(Te,{title:"Create Invoice"},{default:Fe(()=>{var l,r,u;return[t("div",Ge,[e[44]||(e[44]=t("div",{class:"col-12"},[t("div",{class:"subsection-title"},"Invoice Info")],-1)),t("div",Ke,[e[20]||(e[20]=t("label",{class:"form-label"},"Invoice Number",-1)),t("div",We,[I(t("input",{class:"form-control","onUpdate:modelValue":e[0]||(e[0]=o=>s.number=o),placeholder:"e.g., INV-0001"},null,512),[[j,s.number]]),t("button",{class:"btn btn-outline-secondary",type:"button",onClick:xe},"Auto")])]),t("div",Ze,[e[21]||(e[21]=t("label",{class:"form-label"},"Date",-1)),I(t("input",{class:"form-control",type:"date","onUpdate:modelValue":e[1]||(e[1]=o=>s.date=o)},null,512),[[j,s.date]])]),t("div",et,[e[22]||(e[22]=t("label",{class:"form-label"},"Due Date",-1)),I(t("input",{class:"form-control",type:"date","onUpdate:modelValue":e[2]||(e[2]=o=>s.dueDate=o)},null,512),[[j,s.dueDate]])]),e[45]||(e[45]=t("div",{class:"col-12"},[t("div",{class:"subsection-title mt-1"},"Parties")],-1)),t("div",tt,[e[26]||(e[26]=t("label",{class:"form-label"},"Merchant",-1)),I(t("select",{class:"form-select","onUpdate:modelValue":e[3]||(e[3]=o=>s.merchantId=o),disabled:!!s.id},[e[23]||(e[23]=t("option",{value:""},"Select a merchant",-1)),(d(!0),a(N,null,$(E(c).merchants,o=>(d(),a("option",{key:o.id,value:o.id},i(o.name),9,nt))),128))],8,st),[[P,s.merchantId]]),w.value?(d(),a("div",ot,[t("div",it,[e[24]||(e[24]=t("label",{class:"form-label small mb-1"},"Address",-1)),I(t("select",{class:"form-select form-select-sm","onUpdate:modelValue":e[4]||(e[4]=o=>s.merchantAddressId=o)},[(d(!0),a(N,null,$(le.value,o=>(d(),a("option",{key:o.id,value:o.id},i(o.type)+" — "+i(o.city),9,lt))),128))],512),[[P,s.merchantAddressId]])]),t("div",at,[e[25]||(e[25]=t("label",{class:"form-label small mb-1"},"Contact",-1)),I(t("select",{class:"form-select form-select-sm","onUpdate:modelValue":e[5]||(e[5]=o=>s.merchantContactId=o)},[(d(!0),a(N,null,$(ae.value,o=>(d(),a("option",{key:o.id,value:o.id},i(o.type)+" — "+i(o.name),9,dt))),128))],512),[[P,s.merchantContactId]])])])):v("",!0),s.id?(d(),a("div",rt,"Locked for existing invoice")):v("",!0)]),t("div",ut,[e[30]||(e[30]=t("label",{class:"form-label"},"Customer",-1)),I(t("select",{class:"form-select","onUpdate:modelValue":e[6]||(e[6]=o=>s.customerId=o),disabled:!!s.id},[e[27]||(e[27]=t("option",{value:""},"Select a customer",-1)),(d(!0),a(N,null,$(E(c).customers,o=>(d(),a("option",{key:o.id,value:o.id},i(o.name),9,ct))),128))],8,mt),[[P,s.customerId]]),C.value?(d(),a("div",pt,[t("div",vt,[e[28]||(e[28]=t("label",{class:"form-label small mb-1"},"Address",-1)),I(t("select",{class:"form-select form-select-sm","onUpdate:modelValue":e[7]||(e[7]=o=>s.customerAddressId=o)},[(d(!0),a(N,null,$(de.value,o=>(d(),a("option",{key:o.id,value:o.id},i(o.type)+" — "+i(o.city),9,bt))),128))],512),[[P,s.customerAddressId]])]),t("div",ft,[e[29]||(e[29]=t("label",{class:"form-label small mb-1"},"Contact",-1)),I(t("select",{class:"form-select form-select-sm","onUpdate:modelValue":e[8]||(e[8]=o=>s.customerContactId=o)},[(d(!0),a(N,null,$(re.value,o=>(d(),a("option",{key:o.id,value:o.id},i(o.type)+" — "+i(o.name),9,xt))),128))],512),[[P,s.customerContactId]])])])):v("",!0),s.id?(d(),a("div",ht,"Locked for existing invoice")):v("",!0)]),t("div",gt,[e[32]||(e[32]=t("label",{class:"form-label"},"Payment Terms",-1)),I(t("select",{class:"form-select","onUpdate:modelValue":e[9]||(e[9]=o=>s.paymentTermId=o)},[e[31]||(e[31]=t("option",{value:""},"—",-1)),(d(!0),a(N,null,$(E(c).paymentTerms,o=>(d(),a("option",{key:o.id,value:o.id},i(o.name),9,yt))),128))],512),[[P,s.paymentTermId]])]),t("div",It,[e[34]||(e[34]=t("label",{class:"form-label"},"Terms Template",-1)),I(t("select",{class:"form-select","onUpdate:modelValue":e[10]||(e[10]=o=>s.termsTemplateId=o)},[e[33]||(e[33]=t("option",{value:""},"—",-1)),(d(!0),a(N,null,$(E(c).termsTemplates,o=>(d(),a("option",{key:o.id,value:o.id},i(o.name),9,_t))),128))],512),[[P,s.termsTemplateId]])]),e[46]||(e[46]=t("div",{class:"col-12"},[t("div",{class:"subsection-title mt-2"},"Shipping")],-1)),t("div",wt,[e[39]||(e[39]=t("label",{class:"form-label"},"Shipping Method",-1)),I(t("select",{class:"form-select","onUpdate:modelValue":e[11]||(e[11]=o=>s.shippingMethodId=o)},[e[35]||(e[35]=t("option",{value:""},"Select shipping",-1)),(d(!0),a(N,null,$(De.value,o=>(d(),a("option",{key:o.id,value:o.id},i(o.name)+" — ৳"+i(Z(o).toFixed(2))+i(o.chargeType==="percent"?" ("+Number(o.amount)+"%)":"")+i(o.freeThreshold?" · free over ৳"+Number(o.freeThreshold).toFixed(0):""),9,kt))),128))],512),[[P,s.shippingMethodId]]),T.value?(d(),a("div",Nt,[t("div",Ft,[t("div",Tt,[e[36]||(e[36]=t("label",{class:"form-label"},"Amount (৳)",-1)),I(t("input",{class:"form-control form-control-sm text-end",type:"number",min:"0",step:"0.01","onUpdate:modelValue":e[12]||(e[12]=o=>s.shippingAmount=o)},null,512),[[j,s.shippingAmount,void 0,{number:!0}]]),t("div",At,"Auto: "+i(Z(T.value).toFixed(2)),1)]),t("div",St,[t("div",$t,[I(t("input",{class:"form-check-input",type:"checkbox",id:"codSwitch","onUpdate:modelValue":e[13]||(e[13]=o=>s.shippingCod=o)},null,512),[[oe,s.shippingCod]]),e[37]||(e[37]=t("label",{class:"form-check-label",for:"codSwitch"},"COD",-1))]),t("div",Dt,[I(t("input",{class:"form-check-input",type:"checkbox",id:"freeShip","onUpdate:modelValue":e[14]||(e[14]=o=>s.shippingFree=o)},null,512),[[oe,s.shippingFree]]),e[38]||(e[38]=t("label",{class:"form-check-label",for:"freeShip"},"Shipping free",-1))])])]),t("div",Ct," Estimated "+i((l=T.value)==null?void 0:l.leadDaysMin)+"–"+i((r=T.value)==null?void 0:r.leadDaysMax)+" days. Provider COD default: "+i((u=T.value)!=null&&u.codAvailable?"Yes":"No")+". ",1)])):v("",!0)]),e[47]||(e[47]=t("div",{class:"col-12"},[t("div",{class:"subsection-title mt-2"},"Payment")],-1)),t("div",Mt,[t("div",Vt,[t("div",Pt,[e[40]||(e[40]=t("label",{class:"form-label"},"Received Amount (৳)",-1)),I(t("input",{class:"form-control form-control-sm text-end",type:"number",min:"0",step:"0.01","onUpdate:modelValue":e[15]||(e[15]=o=>s.receivedAmount=o),disabled:s.paidInFull},null,8,Ut),[[j,s.receivedAmount,void 0,{number:!0}]])]),t("div",zt,[e[41]||(e[41]=t("label",{class:"form-label"},"Change (৳)",-1)),I(t("input",{class:"form-control form-control-sm text-end",type:"number",min:"0",step:"0.01","onUpdate:modelValue":e[16]||(e[16]=o=>s.changeAmount=o),disabled:s.paidInFull},null,8,qt),[[j,s.changeAmount,void 0,{number:!0}]])]),t("div",jt,[t("div",Et,[I(t("input",{class:"form-check-input",type:"checkbox",id:"paidFull","onUpdate:modelValue":e[17]||(e[17]=o=>s.paidInFull=o)},null,512),[[oe,s.paidInFull]]),e[42]||(e[42]=t("label",{class:"form-check-label",for:"paidFull"},"Mark as Fully Paid",-1))])])])]),e[48]||(e[48]=t("div",{class:"col-12"},[t("div",{class:"subsection-title mt-2"},"Items & Notes")],-1)),t("div",Ot,[ne(He,{ref_key:"itemsEditor",ref:K,items:s.items,products:E(c).products,taxes:E(c).taxes,onUpdate:()=>{}},null,8,["items","products","taxes"])]),t("div",Lt,[e[43]||(e[43]=t("label",{class:"form-label"},"Notes",-1)),I(t("textarea",{class:"form-control",rows:"2","onUpdate:modelValue":e[18]||(e[18]=o=>s.notes=o),placeholder:"Optional notes to show on invoice"},null,512),[[j,s.notes]])])]),t("div",Rt,[t("div",Bt,[t("div",Ht,[t("span",Jt,"Subtotal: "+i(b.value.sub.toFixed(2)),1),t("span",Xt,"Tax: "+i(b.value.tax.toFixed(2)),1),t("span",Yt,"Shipping: "+i((b.value.shipping||0).toFixed(2)),1),t("span",Qt,"Credits: -"+i((M.value||0).toFixed(2)),1),t("span",Gt,"Total: "+i(b.value.total.toFixed(2)),1),t("span",Kt,"Net: "+i((b.value.total-(M.value||0)).toFixed(2)),1)]),t("div",Wt,[t("button",{class:"btn btn-outline-secondary",type:"button",onClick:Pe},"Reset"),t("button",{class:"btn btn-outline-secondary",type:"button",onClick:qe},"Print"),t("button",{class:"btn btn-outline-secondary",type:"button",onClick:je},"Receipt"),t("button",{class:"btn btn-primary",type:"button",onClick:Ee},"Download PDF"),s.id?(d(),a("button",{key:0,class:"btn btn-outline-secondary",type:"button",onClick:e[19]||(e[19]=()=>E(W).push(`/credit-notes/new?invoiceId=${s.id}`))},"New Credit Note")):v("",!0),t("button",{class:"btn btn-success",type:"button",onClick:ze},"Save")])])])]}),_:1})]),t("div",Zt,[ne(Te,{title:"Preview"},{default:Fe(()=>{var l,r,u,o,m,h,y,f,V;return[t("div",{class:"print-area",ref_key:"printRef",ref:A},[t("div",es,[t("div",ts,[t("strong",null,i(((l=w.value)==null?void 0:l.name)||"Select Merchant"),1),e[49]||(e[49]=t("br",null,null,-1)),D.value?(d(),a("span",ss,i(D.value.line1)+", "+i(D.value.city),1)):v("",!0),D.value?(d(),a("br",ns)):v("",!0),(r=w.value)!=null&&r.taxId?(d(),a("span",os,"VAT/TAX ID: "+i(w.value.taxId),1)):v("",!0),(u=w.value)!=null&&u.taxId?(d(),a("br",is)):v("",!0),z.value?(d(),a("span",ls,[B(i(z.value.name),1),z.value.email?(d(),a("span",as," · "+i(z.value.email),1)):v("",!0),z.value.phone?(d(),a("span",ds," · "+i(z.value.phone),1)):v("",!0)])):v("",!0)]),t("div",rs,[e[53]||(e[53]=t("h4",{class:"mb-1"},"Invoice",-1)),t("div",null,[e[50]||(e[50]=t("span",{class:"text-muted"},"No:",-1)),B(" "+i(s.number||"(not set)"),1)]),t("div",null,[e[51]||(e[51]=t("span",{class:"text-muted"},"Date:",-1)),B(" "+i(s.date),1)]),t("div",null,[e[52]||(e[52]=t("span",{class:"text-muted"},"Due:",-1)),B(" "+i(s.dueDate),1)])])]),t("div",us,[e[54]||(e[54]=t("div",{class:"text-uppercase muted-label"},"Bill To",-1)),t("div",ms,i(((o=C.value)==null?void 0:o.name)||"Select Customer"),1),U.value?(d(),a("div",cs,i(U.value.line1)+", "+i(U.value.city),1)):v("",!0),(m=C.value)!=null&&m.taxId?(d(),a("div",ps,"VAT/TAX ID: "+i(C.value.taxId),1)):v("",!0),q.value?(d(),a("div",vs,[B(i(q.value.name),1),q.value.email?(d(),a("span",bs," · "+i(q.value.email),1)):v("",!0),q.value.phone?(d(),a("span",fs," · "+i(q.value.phone),1)):v("",!0)])):v("",!0)]),t("table",xs,[e[56]||(e[56]=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"Product / Description"),t("th",{class:"text-end"},"Qty"),t("th",{class:"text-end"},"Unit"),t("th",{class:"text-end"},"Discount"),t("th",{class:"text-end"},"Line")])],-1)),t("tbody",null,[(d(!0),a(N,null,$(s.items,p=>{var S,L;return d(),a("tr",{key:p.id},[t("td",null,[t("div",hs,i(((S=F(p.productId))==null?void 0:S.name)||p.description||"—"),1),p.description&&((L=F(p.productId))==null?void 0:L.name)!==p.description?(d(),a("div",gs,i(p.description),1)):v("",!0)]),t("td",ys,i(p.qty),1),t("td",Is,i(Number(p.unitPrice||0).toFixed(2)),1),t("td",_s,[(p.discountType||"none")==="percent"?(d(),a("span",ws,"-"+i(Number(p.discountValue||0).toFixed(0))+"%",1)):(p.discountType||"none")==="fixed"?(d(),a("span",ks,"-"+i((Number(p.discountValue||0)*Number(p.qty||0)).toFixed(2)),1)):(d(),a("span",Ns,"—"))]),t("td",Fs,i(H(p).toFixed(2)),1)])}),128)),s.items.length===0?(d(),a("tr",Ts,[...e[55]||(e[55]=[t("td",{colspan:"5",class:"text-muted"},"No items",-1)])])):v("",!0)])]),t("div",As,[e[66]||(e[66]=t("div",{class:"flex-grow-1"},null,-1)),t("div",Ss,[t("div",$s,[e[57]||(e[57]=t("span",null,"Subtotal",-1)),t("span",null,i(b.value.sub.toFixed(2)),1)]),t("div",Ds,[e[58]||(e[58]=t("span",null,"Tax",-1)),t("span",null,i(b.value.tax.toFixed(2)),1)]),t("div",Cs,[e[60]||(e[60]=t("span",null,"Shipping",-1)),t("span",null,[s.shippingFree?(d(),a(N,{key:0},[t("span",Ms,i(Number(s.shippingAmount||0).toFixed(2)),1),e[59]||(e[59]=t("span",{class:"ms-1"},"0.00",-1))],64)):(d(),a(N,{key:1},[B(i((b.value.shipping||0).toFixed(2)),1)],64))])]),t("div",Vs,[e[61]||(e[61]=t("span",null,"Total",-1)),t("span",null,i(b.value.total.toFixed(2)),1)]),M.value>0?(d(),a("div",Ps,[e[62]||(e[62]=t("span",null,"Credits",-1)),t("span",null,"-"+i(M.value.toFixed(2)),1)])):v("",!0),s.paidInFull||Number(s.receivedAmount||0)>0?(d(),a("div",Us,[e[63]||(e[63]=t("span",null,"Received",-1)),t("span",null,i(Number(s.receivedAmount||0).toFixed(2)),1)])):v("",!0),Number(s.changeAmount||0)>0?(d(),a("div",zs,[e[64]||(e[64]=t("span",null,"Change",-1)),t("span",null,i(Number(s.changeAmount||0).toFixed(2)),1)])):v("",!0),s.paidInFull||Number(s.receivedAmount||0)>0||M.value>0?(d(),a("div",qs,[e[65]||(e[65]=t("span",{class:"fw-semibold"},"Balance Due",-1)),t("span",js,i(Math.max(0,b.value.total-M.value-(s.paidInFull?b.value.total:Math.max(0,Number(s.receivedAmount||0)-Number(s.changeAmount||0)))).toFixed(2)),1)])):v("",!0),T.value?(d(),a("div",Es," Shipping via "+i((h=T.value)==null?void 0:h.name)+" ("+i((y=T.value)==null?void 0:y.leadDaysMin)+"–"+i((f=T.value)==null?void 0:f.leadDaysMax)+" days) ",1)):v("",!0)])]),Y.value&&!s.paidInFull?(d(),a("div",Os,[t("strong",null,"Payment Schedule — "+i((V=Y.value)==null?void 0:V.name),1),t("table",Ls,[e[67]||(e[67]=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"Installment"),t("th",null,"Date"),t("th",{class:"text-end"},"Amount")])],-1)),t("tbody",null,[(d(!0),a(N,null,$(ee.value,p=>(d(),a("tr",{key:p.label+p.date},[t("td",null,i(p.label),1),t("td",null,i(p.date),1),t("td",Rs,i(p.amount.toFixed(2)),1)]))),128))])])])):v("",!0),ce.value?(d(),a("div",Bs,[e[68]||(e[68]=t("strong",null,"Terms",-1)),t("div",Hs,i(ce.value),1)])):v("",!0),s.notes?(d(),a("div",Js,[e[69]||(e[69]=t("strong",null,"Notes",-1)),t("div",Xs,i(s.notes),1)])):v("",!0)],512)]}),_:1})])]))}};export{Zs as default};
