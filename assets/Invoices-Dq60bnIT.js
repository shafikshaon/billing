var se=(le,R,s)=>new Promise((K,N)=>{var X=_=>{try{V(s.next(_))}catch(q){N(q)}},W=_=>{try{V(s.throw(_))}catch(q){N(q)}},V=_=>_.done?K(_.value):Promise.resolve(_.value).then(X,W);V((s=s.apply(le,R)).next())});import{r as Oe,s as ke,z as Re,u as qe,b as g,w as J,e as a,o as d,f as t,p as ne,k as Fe,v as Le,x as I,y as j,i as v,F as k,h as A,l as O,t as l,A as M,C as oe,B as E}from"./vendor-CDgTUOzk.js";import{S as Ne}from"./SectionCard-Emg7MEbk.js";import{_ as Be}from"./LineItemsEditor-UcEpNX9l.js";import{s as c,u as Ee}from"./index-DuACpEyu.js";const He={class:"row g-3"},Je={class:"col-lg-6"},Xe={class:"row g-3"},Ye={class:"col-md-4"},Qe={class:"d-flex gap-2"},Ge={class:"col-md-4"},Ke={class:"col-md-4"},We={class:"col-md-6"},Ze=["disabled"],et=["value"],tt={key:0,class:"row g-2 mt-1"},st={class:"col-7"},nt=["value"],ot={class:"col-5"},lt=["value"],it={key:1,class:"form-text"},at={class:"col-md-6"},dt=["disabled"],rt=["value"],ut={key:0,class:"row g-2 mt-1"},mt={class:"col-7"},ct=["value"],pt={class:"col-5"},vt=["value"],bt={key:1,class:"form-text"},ft={class:"col-md-6"},xt=["value"],ht={class:"col-md-6"},gt=["value"],yt={class:"col-md-6"},It=["value"],_t={key:0,class:"mt-2"},wt={class:"row g-2"},kt={class:"col-6"},Ft={class:"form-text"},Nt={class:"col-6 d-flex align-items-end gap-3"},Tt={class:"form-check form-switch"},At={class:"form-check"},St={class:"form-text"},$t={class:"col-12"},Dt={class:"row g-2 align-items-end"},Ct={class:"col-sm-4"},Mt=["disabled"],Vt={class:"col-sm-4"},Pt=["disabled"],Ut={class:"col-sm-4"},zt={class:"form-check mt-4"},jt={class:"col-12"},Ot={class:"col-12"},Rt={class:"form-sticky-actions mt-3"},qt={class:"d-flex flex-wrap align-items-center justify-content-between gap-2 p-2"},Lt={class:"d-flex align-items-center gap-2 flex-wrap"},Bt={class:"badge"},Et={class:"badge"},Ht={class:"badge"},Jt={class:"badge"},Xt={class:"badge"},Yt={class:"badge"},Qt={class:"d-flex gap-2"},Gt={class:"col-lg-6"},Kt={class:"invoice-header d-flex justify-content-between align-items-start border-bottom pb-2 mb-3"},Wt={class:"invoice-brand"},Zt={key:0},es={key:1},ts={key:2,class:"text-muted small"},ss={key:3},ns={key:4,class:"text-muted small"},os={key:0},ls={key:1},is={class:"text-end"},as={class:"mb-2 info-block"},ds={class:"fw-semibold"},rs={key:0},us={key:1,class:"text-muted small"},ms={key:2,class:"text-muted small"},cs={key:0},ps={key:1},vs={class:"table table-sm table-invoice align-middle mt-2"},bs={class:"fw-medium"},fs={key:0,class:"text-muted small"},xs={class:"text-end"},hs={class:"text-end"},gs={class:"text-end"},ys={key:0},Is={key:1},_s={key:2},ws={class:"text-end"},ks={key:0},Fs={class:"mt-2 d-flex"},Ns={class:"totals-card"},Ts={class:"line"},As={class:"line"},Ss={class:"line"},$s={class:"text-decoration-line-through"},Ds={class:"line grand"},Cs={key:0,class:"line"},Ms={key:1,class:"line"},Vs={key:2,class:"line"},Ps={key:3,class:"line"},Us={class:"fw-semibold"},zs={key:4,class:"muted small mt-1"},js={key:0,class:"mt-2"},Os={class:"table table-sm mt-1"},Rs={class:"text-end"},qs={key:1,class:"mt-3"},Ls={style:{"white-space":"pre-wrap"}},Bs={key:2,class:"mt-2"},Es={style:{"white-space":"pre-wrap"}},Gs={__name:"Invoices",setup(le){var xe,he,ge,ye,Ie,_e;const R=()=>new Date().toISOString().slice(0,10),s=Oe({id:"",number:"",date:R(),dueDate:R(),merchantId:"",merchantAddressId:"",merchantContactId:"",customerId:"",customerAddressId:"",customerContactId:"",paymentTermId:((he=(xe=c.settings)==null?void 0:xe.invoice)==null?void 0:he.defaultPaymentTermId)||"",termsTemplateId:((ye=(ge=c.settings)==null?void 0:ge.invoice)==null?void 0:ye.defaultTermsTemplateId)||"",shippingMethodId:((_e=(Ie=c.settings)==null?void 0:Ie.invoice)==null?void 0:_e.defaultShippingMethodId)||"",shippingAmount:0,shippingCod:!1,shippingFree:!1,shippingFee:0,receivedAmount:0,changeAmount:0,paidInFull:!1,notes:"",items:[]}),K=ke(null),N=ke(null),X=qe(),W=Le();Re(()=>{if(X.params.id){const n=c.invoices.find(e=>e.id===X.params.id);n&&Object.assign(s,JSON.parse(JSON.stringify(n)))}s.merchantId&&!s.merchantAddressId&&re(),s.customerId&&!s.customerAddressId&&ue()});function V(n){return c.products.find(e=>e.id===n)}const _=g(()=>c.merchants.find(n=>n.id===s.merchantId)),q=g(()=>{var n;return((n=_.value)==null?void 0:n.addresses)||[]}),ie=g(()=>{var n;return((n=_.value)==null?void 0:n.contacts)||[]}),S=g(()=>q.value.find(n=>n.id===s.merchantAddressId)),U=g(()=>ie.value.find(n=>n.id===s.merchantContactId)),$=g(()=>c.customers.find(n=>n.id===s.customerId)),ae=g(()=>{var n;return((n=$.value)==null?void 0:n.addresses)||[]}),de=g(()=>{var n;return((n=$.value)==null?void 0:n.contacts)||[]}),P=g(()=>ae.value.find(n=>n.id===s.customerAddressId)),z=g(()=>de.value.find(n=>n.id===s.customerContactId));function re(){var e,i,r,u,o,m,h,y;const n=_.value;n&&(s.merchantAddressId=((i=(e=n.addresses)==null?void 0:e.find(f=>f.type==="primary"))==null?void 0:i.id)||((u=(r=n.addresses)==null?void 0:r[0])==null?void 0:u.id)||"",s.merchantContactId=((m=(o=n.contacts)==null?void 0:o.find(f=>f.type==="primary"))==null?void 0:m.id)||((y=(h=n.contacts)==null?void 0:h[0])==null?void 0:y.id)||"")}function ue(){var e,i,r,u,o,m,h,y;const n=$.value;n&&(s.customerAddressId=((i=(e=n.addresses)==null?void 0:e.find(f=>f.type==="primary"))==null?void 0:i.id)||((u=(r=n.addresses)==null?void 0:r[0])==null?void 0:u.id)||"",s.customerContactId=((m=(o=n.contacts)==null?void 0:o.find(f=>f.type==="primary"))==null?void 0:m.id)||((y=(h=n.contacts)==null?void 0:h[0])==null?void 0:y.id)||"")}J(()=>s.merchantId,()=>re()),J(()=>s.customerId,()=>ue());const me=g(()=>{var n;return((n=c.termsTemplates.find(e=>e.id===s.termsTemplateId))==null?void 0:n.content)||""}),Y=g(()=>c.paymentTerms.find(n=>n.id===s.paymentTermId));function H(n){const e=(Number(n.qty)||0)*(Number(n.unitPrice)||0),i=n.discountType||"none",r=Number(n.discountValue)||0,u=i==="percent"?e*r/100:i==="fixed"?(Number(n.qty)||0)*r:0;return Math.max(0,e-u)}const b=g(()=>{let n=0,e=0;for(const r of s.items){const u=H(r);n+=u;const o=c.taxes.find(m=>m.id===r.taxId);o&&(e+=u*(Number(o.rate)||0)/100)}const i=ce.value;return{sub:n,tax:e,shipping:i,total:n+e+i}});function Te(n){return(n.items||[]).reduce((i,r)=>{const u=(Number(r.qty)||0)*(Number(r.unitPrice)||0),o=r.discountType||"none",m=Number(r.discountValue)||0,h=o==="percent"?u*m/100:o==="fixed"?(Number(r.qty)||0)*m:0,y=Math.max(0,u-h),f=(()=>{const C=c.taxes.find(p=>p.id===r.taxId);return C?y*(Number(C.rate)||0)/100:0})();return i+y+f},0)}const Ae=g(()=>(c.creditNotes||[]).filter(n=>!!s.id&&n.originalInvoiceId===s.id&&(n.status==="issued"||n.status==="applied"))),D=g(()=>Ae.value.reduce((n,e)=>n+Te(e),0)),Se=g(()=>{var e,i,r;const n=(((r=(i=(e=$.value)==null?void 0:e.addresses)==null?void 0:i[0])==null?void 0:r.city)||"").toLowerCase();return n?n.includes("dhaka")?"inside_dhaka":"outside_dhaka":"any"}),$e=g(()=>{const n=Se.value;return c.shippingMethods.filter(e=>e.region==="any"||e.region===n)}),F=g(()=>c.shippingMethods.find(n=>n.id===s.shippingMethodId));function Z(n){if(!n)return 0;const e=De.value.sub;return n.freeThreshold&&e>=Number(n.freeThreshold)?0:n.chargeType==="percent"?Number((e*(Number(n.amount)||0)/100).toFixed(2)):Number(n.amount)||0}const ce=g(()=>{var i;if(!F.value)return 0;const e=Number((i=s.shippingAmount)!=null?i:0);return s.shippingFree?0:e});J(()=>s.shippingMethodId,()=>{const n=F.value;n?(s.shippingAmount=Z(n),s.shippingCod=!!n.codAvailable,s.shippingFree=!1):(s.shippingAmount=0,s.shippingCod=!1,s.shippingFree=!1)}),J([()=>s.paidInFull,b],()=>{s.paidInFull&&(s.receivedAmount=Number(b.value.total||0),s.changeAmount=0)});const De=g(()=>{let n=0,e=0;for(const i of s.items){const r=H(i);n+=r;const u=c.taxes.find(o=>o.id===i.taxId);u&&(e+=r*(Number(u.rate)||0)/100)}return{sub:n,tax:e,total:n+e}});function pe(n){const[e,i,r]=n.split("-").map(Number);return new Date(e,i-1,r)}function ve(n){const e=n.getFullYear(),i=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0");return`${e}-${i}-${r}`}function be(n,e){const i=pe(n);return i.setDate(i.getDate()+(Number(e)||0)),ve(i)}function Ce(n,e){const i=pe(n),r=i.getFullYear(),u=i.getMonth(),o=new Date(r,u+1,Math.min(Number(e)||1,31)),m=new Date(o.getFullYear(),o.getMonth()+1,0).getDate();return o.setDate(Math.min(Number(e)||1,m)),ve(o)}const ee=g(()=>{const n=Y.value,e=s.date,i=b.value.total;if(!n||!e)return[];const r=(n.schedule||[]).slice().sort((m,h)=>(m.sequence||0)-(h.sequence||0));let u=i;const o=r.map((m,h)=>{const y=m.dateType==="day_of_month"?Ce(e,m.dayOfMonth||1):be(e,m.days||0);let f=0;return m.valueType==="percent"?f=i*(Number(m.valueAmount)||0)/100:f=Number(m.valueAmount)||0,h===r.length-1&&(f=u),u=Math.max(0,u-f),{label:m.description||`Installment ${h+1}`,date:y,amount:f}});return o.length?o:[{label:"Due",date:be(e,0),amount:i}]}),Me=g(()=>{let n=s.date;for(const e of ee.value)e.date&&e.date>n&&(n=e.date);return n});function Ve(){var n,e;Object.assign(s,{id:"",number:"",date:R(),dueDate:R(),merchantId:"",customerId:"",paymentTermId:((n=c.paymentTerms[0])==null?void 0:n.id)||"",termsTemplateId:((e=c.termsTemplates[0])==null?void 0:e.id)||"",notes:"",items:[]})}J([()=>s.date,()=>s.paymentTermId,b],()=>{s.dueDate=Me.value});function fe(){var i;const n=((i=c.settings)==null?void 0:i.invoice)||{prefix:"INV-",nextNumber:1,zeroPad:0},e=String(n.nextNumber).padStart(Number(n.zeroPad)||0,"0");s.number=`${n.prefix||""}${e}`,n.nextNumber=Number(n.nextNumber||1)+1}function Pe(){var i,r;if(!s.merchantId||!s.customerId)return;!s.number&&((r=(i=c.settings)==null?void 0:i.invoice)!=null&&r.autoNumberOnSave)&&fe(),s.id||(s.id=Ee("inv_")),s.shippingFee=ce.value;const n=JSON.parse(JSON.stringify(s)),e=c.invoices.findIndex(u=>u.id===n.id);e===-1?c.invoices.push(n):c.invoices.splice(e,1,n),window.alert("Invoice saved")}function Ue(){if(!(N!=null&&N.value))return;const n=N.value.outerHTML,e=window.open("","_blank","noopener,noreferrer");e&&(e.document.write(`
    <html>
      <head>
        <meta charset="utf-8"/>
        <title>${s.number||"Invoice"}</title>
        <link rel="stylesheet" href="https://bootswatch.com/5/pulse/bootstrap.min.css"/>
        <style>
          @page { size: A4; margin: 10mm; }
          body { background:#fff; -webkit-print-color-adjust: exact; print-color-adjust: exact; margin: 0; }
          .print-area { width: 190mm; margin: 0 auto; padding: 10mm; border: none; }
          .print-area h4 { font-size: 20px; color: #4a148c; }
          .print-area table { font-size: 12px; }
        </style>
      </head>
      <body>
        ${n}
        <script>
          window.addEventListener('load', function(){
            setTimeout(function(){
              try { window.focus(); window.print(); } finally { window.close(); }
            }, 150);
          });
        <\/script>
      </body>
    </html>
  `),e.document.close())}function ze(){const n=_.value,e=$.value,i=F.value,r=Number(((D==null?void 0:D.value)||0).toFixed(2)),u=Number(b.value.sub.toFixed(2)),o=Number(b.value.tax.toFixed(2)),m=Number(b.value.shipping.toFixed(2)),h=Number(b.value.total.toFixed(2)),y=Number(s.paidInFull?h:Number(s.receivedAmount||0)-Number(s.changeAmount||0)),f=Math.max(0,h-r-y),C=(s.items||[]).map(T=>{var x;const L=((x=V(T.productId))==null?void 0:x.name)||T.description||"—",te=Number(T.qty||0),Q=Number(T.unitPrice||0).toFixed(2),G=Number(H(T).toFixed(2));return`
      <div class="row">
        <div class="name">${L}</div>
        <div class="meta">${te} x ${Q} = ${G.toFixed(2)}</div>
      </div>
    `}).join(""),p=window.open("","_blank","noopener,noreferrer");p&&(p.document.write(`
    <html>
      <head>
        <meta charset="utf-8"/>
        <title>Receipt ${s.number||""}</title>
        <style>
          @page { size: 80mm auto; margin: 0; }
          html, body { padding:0; margin:0; }
          body { -webkit-print-color-adjust: exact; print-color-adjust: exact; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; }
          .receipt { width: 72mm; padding: 4mm 4mm 8mm; }
          .center { text-align:center; }
          .muted { color:#555; }
          .row { margin: 2px 0; }
          .name { font-size: 12px; }
          .meta { font-size: 11px; color:#444; display:flex; justify-content: space-between; }
          .hr { border-top: 1px dashed #000; margin: 6px 0; }
          .totals .line { display:flex; justify-content: space-between; font-size: 12px; }
          .totals .grand { font-weight: 700; }
          .small { font-size: 10px; }
        </style>
      </head>
      <body>
        <div class="receipt">
          <div class="center">
            <div style="font-weight:700">${(n==null?void 0:n.name)||""}</div>
            <div class="small muted">${S!=null&&S.value?S.value.line1+", "+S.value.city:""}</div>
            <div class="small">Invoice: ${s.number||""}</div>
            <div class="small">Date: ${s.date||""}</div>
          </div>

          <div class="hr"></div>

          <div class="small">Customer: ${(e==null?void 0:e.name)||""}</div>
          ${P!=null&&P.value?`<div class="small muted">${P.value.city}</div>`:""}

          <div class="hr"></div>

          ${C||'<div class="small muted">No items</div>'}

          <div class="hr"></div>

          <div class="totals">
            <div class="line"><span>Subtotal</span><span>${u.toFixed(2)}</span></div>
            <div class="line"><span>Tax</span><span>${o.toFixed(2)}</span></div>
            ${m>0?`<div class="line"><span>Shipping</span><span>${m.toFixed(2)}</span></div>`:""}
            <div class="line grand"><span>Total</span><span>${h.toFixed(2)}</span></div>
            ${r>0?`<div class="line"><span>Credits</span><span>-${r.toFixed(2)}</span></div>`:""}
            <div class="line"><span>Received</span><span>${y.toFixed(2)}</span></div>
            <div class="line"><span>Balance</span><span>${f.toFixed(2)}</span></div>
          </div>

          ${i?`<div class="small muted" style="margin-top:6px">Shipping via ${i.name}</div>`:""}

          <div class="center small" style="margin-top:8px">— Thank you —</div>
        </div>

        <script>
          window.addEventListener('load', function(){
            setTimeout(function(){
              try { window.focus(); window.print(); } finally { window.close(); }
            }, 150);
          });
        <\/script>
      </body>
    </html>
  `),p.document.close())}function je(){return se(this,null,function*(){var Q,G;if(!(N!=null&&N.value))return;function n(){return se(this,null,function*(){return window.pdfMake||(yield new Promise((x,B)=>{const w=document.createElement("script");w.src="https://cdn.jsdelivr.net/npm/pdfmake@0.2.10/build/pdfmake.min.js",w.onload=x,w.onerror=B,document.body.appendChild(w)}),yield new Promise((x,B)=>{const w=document.createElement("script");w.src="https://cdn.jsdelivr.net/npm/pdfmake@0.2.10/build/vfs_fonts.min.js",w.onload=x,w.onerror=B,document.body.appendChild(w)})),window.pdfMake})}yield n();const e=_.value,i=$.value,r=S.value,u=P.value,o=U.value,m=z.value,h=ee.value.map(x=>[x.label,x.date,{text:x.amount.toFixed(2),alignment:"right"}]),y=Number(s.receivedAmount||0),f=Number(s.changeAmount||0),C=s.paidInFull?b.value.total||0:Math.max(0,y-f),p=Math.max(0,(b.value.total||0)-C),T=(((Q=c.termsTemplates.find(x=>x.id===s.termsTemplateId))==null?void 0:Q.content)||"").trim(),L=[[{text:"Product / Description",bold:!0},{text:"Qty",alignment:"right",bold:!0},{text:"Unit",alignment:"right",bold:!0},{text:"Discount",alignment:"right",bold:!0},{text:"Line",alignment:"right",bold:!0}],...s.items.map(x=>{var w;const B=(x.discountType||"none")==="percent"?`-${Number(x.discountValue||0).toFixed(0)}%`:(x.discountType||"none")==="fixed"?`- ${(Number(x.discountValue||0)*Number(x.qty||0)).toFixed(2)}`:"—";return[((w=V(x.productId))==null?void 0:w.name)||x.description||"—",{text:String(x.qty||0),alignment:"right"},{text:Number(x.unitPrice||0).toFixed(2),alignment:"right"},{text:B,alignment:"right"},{text:H(x).toFixed(2),alignment:"right"}]})],te={pageSize:"A4",pageMargins:[28,28,28,28],content:[{columns:[[{text:"Invoice",style:"title"},{text:`No: ${s.number||"(not set)"}`},{text:`Date: ${s.date}`},{text:`Due: ${s.dueDate}`}],[{text:(e==null?void 0:e.name)||"Select Merchant",alignment:"right",bold:!0},{text:r?`${r.line1}, ${r.city}`:"",alignment:"right"},e!=null&&e.taxId?{text:`VAT/TAX ID: ${e.taxId}`,alignment:"right",color:"#6c757d",fontSize:9}:{},o?{text:`${o.name}${o.email?" · "+o.email:""}${o.phone?" · "+o.phone:""}`,alignment:"right",color:"#6c757d",fontSize:9}:{}]]},{text:" ",margin:[0,6]},{text:"Bill To",bold:!0},{text:(i==null?void 0:i.name)||"Select Customer"},{text:u?`${u.line1}, ${u.city}`:""},i!=null&&i.taxId?{text:`VAT/TAX ID: ${i.taxId}`,color:"#6c757d",fontSize:9}:{},m?{text:`${m.name}${m.email?" · "+m.email:""}${m.phone?" · "+m.phone:""}`,color:"#6c757d",fontSize:9}:{},{text:" ",margin:[0,6]},{table:{headerRows:1,widths:["*",40,50,55,60],body:L},layout:"lightHorizontalLines"},{columns:[{text:" "},{width:200,alignment:"right",stack:[{text:`Subtotal: ${b.value.sub.toFixed(2)}`},{text:`Tax: ${b.value.tax.toFixed(2)}`},s.shippingFree?{text:["Shipping: 0.00 ",{text:`(was ${Number(s.shippingAmount||0).toFixed(2)})`,decoration:"lineThrough"}]}:{text:`Shipping: ${(b.value.shipping||0).toFixed(2)}`},{text:`Total: ${b.value.total.toFixed(2)}`,bold:!0},s.paidInFull||y>0?{text:`Received: ${y.toFixed(2)}`}:{},f>0?{text:`Change: ${f.toFixed(2)}`}:{},s.paidInFull||y>0?{text:`Balance Due: ${p.toFixed(2)}`,bold:!0}:{}]}],margin:[0,8,0,0]},...h.length&&!s.paidInFull?[{text:`Payment Schedule — ${((G=Y.value)==null?void 0:G.name)||""}`,bold:!0,margin:[0,8,0,4]},{table:{headerRows:1,widths:["*",80,80],body:[[{text:"Installment",bold:!0},{text:"Date",bold:!0},{text:"Amount",alignment:"right",bold:!0}],...h]},layout:"lightHorizontalLines"}]:[],...T?[{text:"Terms",bold:!0,margin:[0,12,0,4]},{text:T,fontSize:9}]:[]],footer:(x,B)=>{var w,we;return{margin:[28,8,28,16],fontSize:9,text:((we=(w=c.settings)==null?void 0:w.invoice)==null?void 0:we.footerText)||""}},styles:{title:{fontSize:18,color:"#4a148c",bold:!0}},defaultStyle:{fontSize:10}};window.pdfMake.createPdf(te).download(`invoice_${s.number||"draft"}.pdf`)})}return(n,e)=>(d(),a("div",He,[t("div",Je,[ne(Ne,{title:"Create Invoice"},{default:Fe(()=>{var i,r,u;return[t("div",Xe,[e[44]||(e[44]=t("div",{class:"col-12"},[t("div",{class:"subsection-title"},"Invoice Info")],-1)),t("div",Ye,[e[20]||(e[20]=t("label",{class:"form-label"},"Invoice Number",-1)),t("div",Qe,[I(t("input",{class:"form-control","onUpdate:modelValue":e[0]||(e[0]=o=>s.number=o),placeholder:"e.g., INV-0001"},null,512),[[j,s.number]]),t("button",{class:"btn btn-outline-secondary",type:"button",onClick:fe},"Auto")])]),t("div",Ge,[e[21]||(e[21]=t("label",{class:"form-label"},"Date",-1)),I(t("input",{class:"form-control",type:"date","onUpdate:modelValue":e[1]||(e[1]=o=>s.date=o)},null,512),[[j,s.date]])]),t("div",Ke,[e[22]||(e[22]=t("label",{class:"form-label"},"Due Date",-1)),I(t("input",{class:"form-control",type:"date","onUpdate:modelValue":e[2]||(e[2]=o=>s.dueDate=o)},null,512),[[j,s.dueDate]])]),e[45]||(e[45]=t("div",{class:"col-12"},[t("div",{class:"subsection-title mt-1"},"Parties")],-1)),t("div",We,[e[26]||(e[26]=t("label",{class:"form-label"},"Merchant",-1)),I(t("select",{class:"form-select","onUpdate:modelValue":e[3]||(e[3]=o=>s.merchantId=o),disabled:!!s.id},[e[23]||(e[23]=t("option",{value:""},"Select a merchant",-1)),(d(!0),a(k,null,A(O(c).merchants,o=>(d(),a("option",{key:o.id,value:o.id},l(o.name),9,et))),128))],8,Ze),[[M,s.merchantId]]),_.value?(d(),a("div",tt,[t("div",st,[e[24]||(e[24]=t("label",{class:"form-label small mb-1"},"Address",-1)),I(t("select",{class:"form-select form-select-sm","onUpdate:modelValue":e[4]||(e[4]=o=>s.merchantAddressId=o)},[(d(!0),a(k,null,A(q.value,o=>(d(),a("option",{key:o.id,value:o.id},l(o.type)+" — "+l(o.city),9,nt))),128))],512),[[M,s.merchantAddressId]])]),t("div",ot,[e[25]||(e[25]=t("label",{class:"form-label small mb-1"},"Contact",-1)),I(t("select",{class:"form-select form-select-sm","onUpdate:modelValue":e[5]||(e[5]=o=>s.merchantContactId=o)},[(d(!0),a(k,null,A(ie.value,o=>(d(),a("option",{key:o.id,value:o.id},l(o.type)+" — "+l(o.name),9,lt))),128))],512),[[M,s.merchantContactId]])])])):v("",!0),s.id?(d(),a("div",it,"Locked for existing invoice")):v("",!0)]),t("div",at,[e[30]||(e[30]=t("label",{class:"form-label"},"Customer",-1)),I(t("select",{class:"form-select","onUpdate:modelValue":e[6]||(e[6]=o=>s.customerId=o),disabled:!!s.id},[e[27]||(e[27]=t("option",{value:""},"Select a customer",-1)),(d(!0),a(k,null,A(O(c).customers,o=>(d(),a("option",{key:o.id,value:o.id},l(o.name),9,rt))),128))],8,dt),[[M,s.customerId]]),$.value?(d(),a("div",ut,[t("div",mt,[e[28]||(e[28]=t("label",{class:"form-label small mb-1"},"Address",-1)),I(t("select",{class:"form-select form-select-sm","onUpdate:modelValue":e[7]||(e[7]=o=>s.customerAddressId=o)},[(d(!0),a(k,null,A(ae.value,o=>(d(),a("option",{key:o.id,value:o.id},l(o.type)+" — "+l(o.city),9,ct))),128))],512),[[M,s.customerAddressId]])]),t("div",pt,[e[29]||(e[29]=t("label",{class:"form-label small mb-1"},"Contact",-1)),I(t("select",{class:"form-select form-select-sm","onUpdate:modelValue":e[8]||(e[8]=o=>s.customerContactId=o)},[(d(!0),a(k,null,A(de.value,o=>(d(),a("option",{key:o.id,value:o.id},l(o.type)+" — "+l(o.name),9,vt))),128))],512),[[M,s.customerContactId]])])])):v("",!0),s.id?(d(),a("div",bt,"Locked for existing invoice")):v("",!0)]),t("div",ft,[e[32]||(e[32]=t("label",{class:"form-label"},"Payment Terms",-1)),I(t("select",{class:"form-select","onUpdate:modelValue":e[9]||(e[9]=o=>s.paymentTermId=o)},[e[31]||(e[31]=t("option",{value:""},"—",-1)),(d(!0),a(k,null,A(O(c).paymentTerms,o=>(d(),a("option",{key:o.id,value:o.id},l(o.name),9,xt))),128))],512),[[M,s.paymentTermId]])]),t("div",ht,[e[34]||(e[34]=t("label",{class:"form-label"},"Terms Template",-1)),I(t("select",{class:"form-select","onUpdate:modelValue":e[10]||(e[10]=o=>s.termsTemplateId=o)},[e[33]||(e[33]=t("option",{value:""},"—",-1)),(d(!0),a(k,null,A(O(c).termsTemplates,o=>(d(),a("option",{key:o.id,value:o.id},l(o.name),9,gt))),128))],512),[[M,s.termsTemplateId]])]),e[46]||(e[46]=t("div",{class:"col-12"},[t("div",{class:"subsection-title mt-2"},"Shipping")],-1)),t("div",yt,[e[39]||(e[39]=t("label",{class:"form-label"},"Shipping Method",-1)),I(t("select",{class:"form-select","onUpdate:modelValue":e[11]||(e[11]=o=>s.shippingMethodId=o)},[e[35]||(e[35]=t("option",{value:""},"Select shipping",-1)),(d(!0),a(k,null,A($e.value,o=>(d(),a("option",{key:o.id,value:o.id},l(o.name)+" — ৳"+l(Z(o).toFixed(2))+l(o.chargeType==="percent"?" ("+Number(o.amount)+"%)":"")+l(o.freeThreshold?" · free over ৳"+Number(o.freeThreshold).toFixed(0):""),9,It))),128))],512),[[M,s.shippingMethodId]]),F.value?(d(),a("div",_t,[t("div",wt,[t("div",kt,[e[36]||(e[36]=t("label",{class:"form-label"},"Amount (৳)",-1)),I(t("input",{class:"form-control form-control-sm text-end",type:"number",min:"0",step:"0.01","onUpdate:modelValue":e[12]||(e[12]=o=>s.shippingAmount=o)},null,512),[[j,s.shippingAmount,void 0,{number:!0}]]),t("div",Ft,"Auto: "+l(Z(F.value).toFixed(2)),1)]),t("div",Nt,[t("div",Tt,[I(t("input",{class:"form-check-input",type:"checkbox",id:"codSwitch","onUpdate:modelValue":e[13]||(e[13]=o=>s.shippingCod=o)},null,512),[[oe,s.shippingCod]]),e[37]||(e[37]=t("label",{class:"form-check-label",for:"codSwitch"},"COD",-1))]),t("div",At,[I(t("input",{class:"form-check-input",type:"checkbox",id:"freeShip","onUpdate:modelValue":e[14]||(e[14]=o=>s.shippingFree=o)},null,512),[[oe,s.shippingFree]]),e[38]||(e[38]=t("label",{class:"form-check-label",for:"freeShip"},"Shipping free",-1))])])]),t("div",St," Estimated "+l((i=F.value)==null?void 0:i.leadDaysMin)+"–"+l((r=F.value)==null?void 0:r.leadDaysMax)+" days. Provider COD default: "+l((u=F.value)!=null&&u.codAvailable?"Yes":"No")+". ",1)])):v("",!0)]),e[47]||(e[47]=t("div",{class:"col-12"},[t("div",{class:"subsection-title mt-2"},"Payment")],-1)),t("div",$t,[t("div",Dt,[t("div",Ct,[e[40]||(e[40]=t("label",{class:"form-label"},"Received Amount (৳)",-1)),I(t("input",{class:"form-control form-control-sm text-end",type:"number",min:"0",step:"0.01","onUpdate:modelValue":e[15]||(e[15]=o=>s.receivedAmount=o),disabled:s.paidInFull},null,8,Mt),[[j,s.receivedAmount,void 0,{number:!0}]])]),t("div",Vt,[e[41]||(e[41]=t("label",{class:"form-label"},"Change (৳)",-1)),I(t("input",{class:"form-control form-control-sm text-end",type:"number",min:"0",step:"0.01","onUpdate:modelValue":e[16]||(e[16]=o=>s.changeAmount=o),disabled:s.paidInFull},null,8,Pt),[[j,s.changeAmount,void 0,{number:!0}]])]),t("div",Ut,[t("div",zt,[I(t("input",{class:"form-check-input",type:"checkbox",id:"paidFull","onUpdate:modelValue":e[17]||(e[17]=o=>s.paidInFull=o)},null,512),[[oe,s.paidInFull]]),e[42]||(e[42]=t("label",{class:"form-check-label",for:"paidFull"},"Mark as Fully Paid",-1))])])])]),e[48]||(e[48]=t("div",{class:"col-12"},[t("div",{class:"subsection-title mt-2"},"Items & Notes")],-1)),t("div",jt,[ne(Be,{ref_key:"itemsEditor",ref:K,items:s.items,products:O(c).products,taxes:O(c).taxes,onUpdate:()=>{}},null,8,["items","products","taxes"])]),t("div",Ot,[e[43]||(e[43]=t("label",{class:"form-label"},"Notes",-1)),I(t("textarea",{class:"form-control",rows:"2","onUpdate:modelValue":e[18]||(e[18]=o=>s.notes=o),placeholder:"Optional notes to show on invoice"},null,512),[[j,s.notes]])])]),t("div",Rt,[t("div",qt,[t("div",Lt,[t("span",Bt,"Subtotal: "+l(b.value.sub.toFixed(2)),1),t("span",Et,"Tax: "+l(b.value.tax.toFixed(2)),1),t("span",Ht,"Shipping: "+l((b.value.shipping||0).toFixed(2)),1),t("span",Jt,"Credits: -"+l((D.value||0).toFixed(2)),1),t("span",Xt,"Total: "+l(b.value.total.toFixed(2)),1),t("span",Yt,"Net: "+l((b.value.total-(D.value||0)).toFixed(2)),1)]),t("div",Qt,[t("button",{class:"btn btn-outline-secondary",type:"button",onClick:Ve},"Reset"),t("button",{class:"btn btn-outline-secondary",type:"button",onClick:Ue},"Print"),t("button",{class:"btn btn-outline-secondary",type:"button",onClick:ze},"Receipt"),t("button",{class:"btn btn-primary",type:"button",onClick:je},"Download PDF"),s.id?(d(),a("button",{key:0,class:"btn btn-outline-secondary",type:"button",onClick:e[19]||(e[19]=()=>O(W).push(`/credit-notes/new?invoiceId=${s.id}`))},"New Credit Note")):v("",!0),t("button",{class:"btn btn-success",type:"button",onClick:Pe},"Save")])])])]}),_:1})]),t("div",Gt,[ne(Ne,{title:"Preview"},{default:Fe(()=>{var i,r,u,o,m,h,y,f,C;return[t("div",{class:"print-area",ref_key:"printRef",ref:N},[t("div",Kt,[t("div",Wt,[t("strong",null,l(((i=_.value)==null?void 0:i.name)||"Select Merchant"),1),e[49]||(e[49]=t("br",null,null,-1)),S.value?(d(),a("span",Zt,l(S.value.line1)+", "+l(S.value.city),1)):v("",!0),S.value?(d(),a("br",es)):v("",!0),(r=_.value)!=null&&r.taxId?(d(),a("span",ts,"VAT/TAX ID: "+l(_.value.taxId),1)):v("",!0),(u=_.value)!=null&&u.taxId?(d(),a("br",ss)):v("",!0),U.value?(d(),a("span",ns,[E(l(U.value.name),1),U.value.email?(d(),a("span",os," · "+l(U.value.email),1)):v("",!0),U.value.phone?(d(),a("span",ls," · "+l(U.value.phone),1)):v("",!0)])):v("",!0)]),t("div",is,[e[53]||(e[53]=t("h4",{class:"mb-1"},"Invoice",-1)),t("div",null,[e[50]||(e[50]=t("span",{class:"text-muted"},"No:",-1)),E(" "+l(s.number||"(not set)"),1)]),t("div",null,[e[51]||(e[51]=t("span",{class:"text-muted"},"Date:",-1)),E(" "+l(s.date),1)]),t("div",null,[e[52]||(e[52]=t("span",{class:"text-muted"},"Due:",-1)),E(" "+l(s.dueDate),1)])])]),t("div",as,[e[54]||(e[54]=t("div",{class:"text-uppercase muted-label"},"Bill To",-1)),t("div",ds,l(((o=$.value)==null?void 0:o.name)||"Select Customer"),1),P.value?(d(),a("div",rs,l(P.value.line1)+", "+l(P.value.city),1)):v("",!0),(m=$.value)!=null&&m.taxId?(d(),a("div",us,"VAT/TAX ID: "+l($.value.taxId),1)):v("",!0),z.value?(d(),a("div",ms,[E(l(z.value.name),1),z.value.email?(d(),a("span",cs," · "+l(z.value.email),1)):v("",!0),z.value.phone?(d(),a("span",ps," · "+l(z.value.phone),1)):v("",!0)])):v("",!0)]),t("table",vs,[e[56]||(e[56]=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"Product / Description"),t("th",{class:"text-end"},"Qty"),t("th",{class:"text-end"},"Unit"),t("th",{class:"text-end"},"Discount"),t("th",{class:"text-end"},"Line")])],-1)),t("tbody",null,[(d(!0),a(k,null,A(s.items,p=>{var T,L;return d(),a("tr",{key:p.id},[t("td",null,[t("div",bs,l(((T=V(p.productId))==null?void 0:T.name)||p.description||"—"),1),p.description&&((L=V(p.productId))==null?void 0:L.name)!==p.description?(d(),a("div",fs,l(p.description),1)):v("",!0)]),t("td",xs,l(p.qty),1),t("td",hs,l(Number(p.unitPrice||0).toFixed(2)),1),t("td",gs,[(p.discountType||"none")==="percent"?(d(),a("span",ys,"-"+l(Number(p.discountValue||0).toFixed(0))+"%",1)):(p.discountType||"none")==="fixed"?(d(),a("span",Is,"-"+l((Number(p.discountValue||0)*Number(p.qty||0)).toFixed(2)),1)):(d(),a("span",_s,"—"))]),t("td",ws,l(H(p).toFixed(2)),1)])}),128)),s.items.length===0?(d(),a("tr",ks,[...e[55]||(e[55]=[t("td",{colspan:"5",class:"text-muted"},"No items",-1)])])):v("",!0)])]),t("div",Fs,[e[66]||(e[66]=t("div",{class:"flex-grow-1"},null,-1)),t("div",Ns,[t("div",Ts,[e[57]||(e[57]=t("span",null,"Subtotal",-1)),t("span",null,l(b.value.sub.toFixed(2)),1)]),t("div",As,[e[58]||(e[58]=t("span",null,"Tax",-1)),t("span",null,l(b.value.tax.toFixed(2)),1)]),t("div",Ss,[e[60]||(e[60]=t("span",null,"Shipping",-1)),t("span",null,[s.shippingFree?(d(),a(k,{key:0},[t("span",$s,l(Number(s.shippingAmount||0).toFixed(2)),1),e[59]||(e[59]=t("span",{class:"ms-1"},"0.00",-1))],64)):(d(),a(k,{key:1},[E(l((b.value.shipping||0).toFixed(2)),1)],64))])]),t("div",Ds,[e[61]||(e[61]=t("span",null,"Total",-1)),t("span",null,l(b.value.total.toFixed(2)),1)]),D.value>0?(d(),a("div",Cs,[e[62]||(e[62]=t("span",null,"Credits",-1)),t("span",null,"-"+l(D.value.toFixed(2)),1)])):v("",!0),s.paidInFull||Number(s.receivedAmount||0)>0?(d(),a("div",Ms,[e[63]||(e[63]=t("span",null,"Received",-1)),t("span",null,l(Number(s.receivedAmount||0).toFixed(2)),1)])):v("",!0),Number(s.changeAmount||0)>0?(d(),a("div",Vs,[e[64]||(e[64]=t("span",null,"Change",-1)),t("span",null,l(Number(s.changeAmount||0).toFixed(2)),1)])):v("",!0),s.paidInFull||Number(s.receivedAmount||0)>0||D.value>0?(d(),a("div",Ps,[e[65]||(e[65]=t("span",{class:"fw-semibold"},"Balance Due",-1)),t("span",Us,l(Math.max(0,b.value.total-D.value-(s.paidInFull?b.value.total:Math.max(0,Number(s.receivedAmount||0)-Number(s.changeAmount||0)))).toFixed(2)),1)])):v("",!0),F.value?(d(),a("div",zs," Shipping via "+l((h=F.value)==null?void 0:h.name)+" ("+l((y=F.value)==null?void 0:y.leadDaysMin)+"–"+l((f=F.value)==null?void 0:f.leadDaysMax)+" days) ",1)):v("",!0)])]),Y.value&&!s.paidInFull?(d(),a("div",js,[t("strong",null,"Payment Schedule — "+l((C=Y.value)==null?void 0:C.name),1),t("table",Os,[e[67]||(e[67]=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"Installment"),t("th",null,"Date"),t("th",{class:"text-end"},"Amount")])],-1)),t("tbody",null,[(d(!0),a(k,null,A(ee.value,p=>(d(),a("tr",{key:p.label+p.date},[t("td",null,l(p.label),1),t("td",null,l(p.date),1),t("td",Rs,l(p.amount.toFixed(2)),1)]))),128))])])])):v("",!0),me.value?(d(),a("div",qs,[e[68]||(e[68]=t("strong",null,"Terms",-1)),t("div",Ls,l(me.value),1)])):v("",!0),s.notes?(d(),a("div",Bs,[e[69]||(e[69]=t("strong",null,"Notes",-1)),t("div",Es,l(s.notes),1)])):v("",!0)],512)]}),_:1})])]))}};export{Gs as default};
