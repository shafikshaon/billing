import{v as E,x as _,b as p,d as u,o as c,e as t,p as F,l as M,j as R,t as l,F as V,g as j,m as $,n as Q,y as A,z as U,B as Z}from"./vendor-BvFxYDzW.js";import{S as G}from"./SectionCard-lIjXfEoU.js";import{s as m}from"./index-B1P3bt3z.js";const H={class:"row g-3"},J={class:"col-12"},K={class:"d-flex gap-2"},O={class:"search-bar"},W={key:0,class:"empty-state"},X={class:"empty-state-title"},Y={class:"empty-state-description"},tt={key:0,class:"empty-state-action"},et={class:"table-wrapper"},st={class:"table table-sm align-middle"},ot={class:"fw-medium"},nt={class:"text-end"},at={class:"text-end"},lt={class:"btn-group btn-group-sm"},it=["onClick"],dt=["onClick"],rt={class:"table-footer"},ut={class:"small text-muted"},ct={class:"btn-group btn-group-sm"},mt=["disabled"],vt=["disabled"],w=10,ht={__name:"CreditNotesList",setup(pt){const g=E(),b=_(""),f=_(!0),y=_("all"),d=_(1);function L(n){return(n.items||[]).reduce((s,o)=>{const i=(Number(o.qty)||0)*(Number(o.unitPrice)||0),a=o.discountType||"none",v=Number(o.discountValue)||0,h=a==="percent"?i*v/100:a==="fixed"?(Number(o.qty)||0)*v:0,r=Math.max(0,i-h),q=(()=>{const S=m.taxes.find(z=>z.id===o.taxId);return S?r*(Number(S.rate)||0)/100:0})();return s+r+q},0)}const N=p(()=>{const n=b.value.trim().toLowerCase();let e=(m.creditNotes||[]).slice();return y.value!=="all"&&(e=e.filter(s=>(s.status||"draft")===y.value)),n&&(e=e.filter(s=>{var o,i,a,v,h;return((o=s.number)==null?void 0:o.toLowerCase().includes(n))||((a=(i=m.customers.find(r=>r.id===s.customerId))==null?void 0:i.name)==null?void 0:a.toLowerCase().includes(n))||((h=(v=m.invoices.find(r=>r.id===s.originalInvoiceId))==null?void 0:v.number)==null?void 0:h.toLowerCase().includes(n))})),e.sort((s,o)=>f.value?(s.number||"").localeCompare(o.number||""):(o.number||"").localeCompare(s.number||"")),e}),C=p(()=>Math.max(1,Math.ceil(N.value.length/w))),k=p(()=>{const e=(Math.min(d.value,C.value)-1)*w;return N.value.slice(e,e+w)}),x=p(()=>b.value.trim().length>0),T=p(()=>k.value.length===0);function I(){g.push("/credit-notes/new")}function B(n){g.push(`/credit-notes/${n.id}`)}function D(n){g.push(`/credit-notes/${n.id}/edit`)}function P(n){return{draft:"badge-draft",issued:"badge-sent",applied:"badge-paid",voided:"badge-void"}[n]||"badge-draft"}return(n,e)=>(c(),u("div",H,[t("div",J,[F(G,{title:"Credit Notes"},{actions:M(()=>[t("div",K,[t("div",O,[e[5]||(e[5]=t("span",{class:"search-icon"},"ðŸ”",-1)),A(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>b.value=s),class:"form-control form-control-sm",placeholder:"Search credit notes..."},null,512),[[U,b.value]])]),A(t("select",{class:"form-select form-select-sm",style:{"max-width":"140px"},"onUpdate:modelValue":e[1]||(e[1]=s=>y.value=s)},[...e[6]||(e[6]=[t("option",{value:"all"},"All",-1),t("option",{value:"draft"},"Draft",-1),t("option",{value:"issued"},"Issued",-1),t("option",{value:"applied"},"Applied",-1),t("option",{value:"voided"},"Voided",-1)])],512),[[Z,y.value]]),t("button",{class:"btn btn-sm btn-outline-secondary",type:"button",onClick:e[2]||(e[2]=s=>f.value=!f.value)},"Sort "+l(f.value?"Aâ†’Z":"Zâ†’A"),1),t("button",{class:"btn btn-sm btn-primary",type:"button",onClick:I},"Create")])]),default:M(()=>[T.value?(c(),u("div",W,[e[7]||(e[7]=t("div",{class:"empty-state-icon"},"ðŸ’³",-1)),t("div",X,l(x.value?"No credit notes found":"No credit notes yet"),1),t("div",Y,l(x.value?"Try adjusting your search or filters to find what you're looking for.":"Get started by creating your first credit note to issue refunds or credits to customers."),1),x.value?R("",!0):(c(),u("div",tt,[t("button",{class:"btn btn-primary",onClick:I}," Create Credit Note ")]))])):(c(),u(V,{key:1},[t("div",et,[t("table",st,[e[8]||(e[8]=t("thead",null,[t("tr",null,[t("th",null,"No"),t("th",null,"Date"),t("th",null,"Customer"),t("th",null,"Ref Invoice"),t("th",null,"Status"),t("th",{class:"text-end"},"Amount (à§³)"),t("th",{class:"text-end"})])],-1)),t("tbody",null,[(c(!0),u(V,null,j(k.value,s=>{var o,i;return c(),u("tr",{key:s.id},[t("td",ot,l(s.number),1),t("td",null,l(s.date),1),t("td",null,l((o=$(m).customers.find(a=>a.id===s.customerId))==null?void 0:o.name),1),t("td",null,l(((i=$(m).invoices.find(a=>a.id===s.originalInvoiceId))==null?void 0:i.number)||"â€”"),1),t("td",null,[t("span",{class:Q(["badge",P(s.status||"draft")])},l(s.status||"draft"),3)]),t("td",nt,l(L(s).toFixed(2)),1),t("td",at,[t("div",lt,[t("button",{class:"btn btn-outline-secondary",onClick:a=>B(s)},"View",8,it),t("button",{class:"btn btn-outline-secondary",onClick:a=>D(s)},"Edit",8,dt)])])])}),128))])])]),t("div",rt,[t("div",ut,"Page "+l(d.value)+" of "+l(C.value),1),t("div",ct,[t("button",{class:"btn btn-outline-secondary",disabled:d.value<=1,onClick:e[3]||(e[3]=s=>d.value--)},"Prev",8,mt),t("button",{class:"btn btn-outline-secondary",disabled:d.value>=C.value,onClick:e[4]||(e[4]=s=>d.value++)},"Next",8,vt)])])],64))]),_:1})])]))}};export{ht as default};
