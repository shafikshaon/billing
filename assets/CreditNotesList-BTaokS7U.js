import{r,d as f,s as i,c,o as m,a as t,b as P,w as k,e as q,f as B,F,g as R,t as l,u as I,h as S,v as z,m as E}from"./index-Cy1DQ3NH.js";import{S as U}from"./SectionCard-C-9hBTcE.js";const Z={class:"row g-3"},j={class:"col-12"},G={class:"d-flex gap-2"},H={class:"table-wrapper"},J={class:"table table-sm align-middle"},K={class:"fw-medium"},O={class:"text-capitalize"},Q={class:"text-end"},W={class:"text-end"},X={class:"btn-group btn-group-sm"},Y=["onClick"],tt=["onClick"],et={key:0},st={class:"table-footer"},ot={class:"small text-muted"},nt={class:"btn-group btn-group-sm"},lt=["disabled"],at=["disabled"],_=10,rt={__name:"CreditNotesList",setup(it){const v=q(),b=r(""),d=r(!0),u=r("all"),a=r(1);function V(n){return(n.items||[]).reduce((s,o)=>{const C=(Number(o.qty)||0)*(Number(o.unitPrice)||0),g=o.discountType||"none",y=Number(o.discountValue)||0,M=g==="percent"?C*y/100:g==="fixed"?(Number(o.qty)||0)*y:0,w=Math.max(0,C-M),T=(()=>{const N=i.taxes.find(D=>D.id===o.taxId);return N?w*(Number(N.rate)||0)/100:0})();return s+w+T},0)}const h=f(()=>{const n=b.value.trim().toLowerCase();let e=(i.creditNotes||[]).slice();return u.value!=="all"&&(e=e.filter(s=>(s.status||"draft")===u.value)),n&&(e=e.filter(s=>s.number?.toLowerCase().includes(n)||i.customers.find(o=>o.id===s.customerId)?.name?.toLowerCase().includes(n)||i.invoices.find(o=>o.id===s.originalInvoiceId)?.number?.toLowerCase().includes(n))),e.sort((s,o)=>d.value?(s.number||"").localeCompare(o.number||""):(o.number||"").localeCompare(s.number||"")),e}),p=f(()=>Math.max(1,Math.ceil(h.value.length/_))),x=f(()=>{const e=(Math.min(a.value,p.value)-1)*_;return h.value.slice(e,e+_)});function $(){v.push("/credit-notes/new")}function A(n){v.push(`/credit-notes/${n.id}`)}function L(n){v.push(`/credit-notes/${n.id}/edit`)}return(n,e)=>(m(),c("div",Z,[t("div",j,[P(U,{title:"Credit Notes"},{actions:k(()=>[t("div",G,[S(t("input",{class:"form-control form-control-sm",placeholder:"Search by number, invoice or customer...","onUpdate:modelValue":e[0]||(e[0]=s=>b.value=s)},null,512),[[z,b.value]]),S(t("select",{class:"form-select form-select-sm",style:{"max-width":"140px"},"onUpdate:modelValue":e[1]||(e[1]=s=>u.value=s)},[...e[5]||(e[5]=[t("option",{value:"all"},"All",-1),t("option",{value:"draft"},"Draft",-1),t("option",{value:"issued"},"Issued",-1),t("option",{value:"applied"},"Applied",-1),t("option",{value:"voided"},"Voided",-1)])],512),[[E,u.value]]),t("button",{class:"btn btn-sm btn-outline-secondary",type:"button",onClick:e[2]||(e[2]=s=>d.value=!d.value)},"Sort "+l(d.value?"A→Z":"Z→A"),1),t("button",{class:"btn btn-sm btn-primary",type:"button",onClick:$},"Create")])]),default:k(()=>[t("div",H,[t("table",J,[e[7]||(e[7]=t("thead",null,[t("tr",null,[t("th",null,"No"),t("th",null,"Date"),t("th",null,"Customer"),t("th",null,"Ref Invoice"),t("th",null,"Status"),t("th",{class:"text-end"},"Amount (৳)"),t("th",{class:"text-end"})])],-1)),t("tbody",null,[(m(!0),c(F,null,R(x.value,s=>(m(),c("tr",{key:s.id},[t("td",K,l(s.number),1),t("td",null,l(s.date),1),t("td",null,l(I(i).customers.find(o=>o.id===s.customerId)?.name),1),t("td",null,l(I(i).invoices.find(o=>o.id===s.originalInvoiceId)?.number||"—"),1),t("td",O,l(s.status||"draft"),1),t("td",Q,l(V(s).toFixed(2)),1),t("td",W,[t("div",X,[t("button",{class:"btn btn-outline-secondary",onClick:o=>A(s)},"View",8,Y),t("button",{class:"btn btn-outline-secondary",onClick:o=>L(s)},"Edit",8,tt)])])]))),128)),x.value.length===0?(m(),c("tr",et,[...e[6]||(e[6]=[t("td",{colspan:"7",class:"text-muted"},"No credit notes found.",-1)])])):B("",!0)])])]),t("div",st,[t("div",ot,"Page "+l(a.value)+" of "+l(p.value),1),t("div",nt,[t("button",{class:"btn btn-outline-secondary",disabled:a.value<=1,onClick:e[3]||(e[3]=s=>a.value--)},"Prev",8,lt),t("button",{class:"btn btn-outline-secondary",disabled:a.value>=p.value,onClick:e[4]||(e[4]=s=>a.value++)},"Next",8,at)])])]),_:1})])]))}};export{rt as default};
