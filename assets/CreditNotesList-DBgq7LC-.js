import{s as p,b as y,e as f,o as _,f as t,p as P,k as I,v as q,i as B,F,h as R,t as a,l as S,x as V,y as z,A as E}from"./vendor-CDgTUOzk.js";import{S as U}from"./SectionCard-CnFX6nPM.js";import{s as r}from"./index-DwkO3c2h.js";const Z={class:"row g-3"},j={class:"col-12"},G={class:"d-flex gap-2"},H={class:"table-wrapper"},J={class:"table table-sm align-middle"},K={class:"fw-medium"},O={class:"text-capitalize"},Q={class:"text-end"},W={class:"text-end"},X={class:"btn-group btn-group-sm"},Y=["onClick"],tt=["onClick"],et={key:0},st={class:"table-footer"},ot={class:"small text-muted"},nt={class:"btn-group btn-group-sm"},lt=["disabled"],at=["disabled"],g=10,ct={__name:"CreditNotesList",setup(it){const h=q(),x=p(""),m=p(!0),v=p("all"),d=p(1);function A(n){return(n.items||[]).reduce((s,o)=>{const i=(Number(o.qty)||0)*(Number(o.unitPrice)||0),l=o.discountType||"none",c=Number(o.discountValue)||0,b=l==="percent"?i*c/100:l==="fixed"?(Number(o.qty)||0)*c:0,u=Math.max(0,i-b),T=(()=>{const k=r.taxes.find(D=>D.id===o.taxId);return k?u*(Number(k.rate)||0)/100:0})();return s+u+T},0)}const w=y(()=>{const n=x.value.trim().toLowerCase();let e=(r.creditNotes||[]).slice();return v.value!=="all"&&(e=e.filter(s=>(s.status||"draft")===v.value)),n&&(e=e.filter(s=>{var o,i,l,c,b;return((o=s.number)==null?void 0:o.toLowerCase().includes(n))||((l=(i=r.customers.find(u=>u.id===s.customerId))==null?void 0:i.name)==null?void 0:l.toLowerCase().includes(n))||((b=(c=r.invoices.find(u=>u.id===s.originalInvoiceId))==null?void 0:c.number)==null?void 0:b.toLowerCase().includes(n))})),e.sort((s,o)=>m.value?(s.number||"").localeCompare(o.number||""):(o.number||"").localeCompare(s.number||"")),e}),C=y(()=>Math.max(1,Math.ceil(w.value.length/g))),N=y(()=>{const e=(Math.min(d.value,C.value)-1)*g;return w.value.slice(e,e+g)});function $(){h.push("/credit-notes/new")}function L(n){h.push(`/credit-notes/${n.id}`)}function M(n){h.push(`/credit-notes/${n.id}/edit`)}return(n,e)=>(_(),f("div",Z,[t("div",j,[P(U,{title:"Credit Notes"},{actions:I(()=>[t("div",G,[V(t("input",{class:"form-control form-control-sm",placeholder:"Search by number, invoice or customer...","onUpdate:modelValue":e[0]||(e[0]=s=>x.value=s)},null,512),[[z,x.value]]),V(t("select",{class:"form-select form-select-sm",style:{"max-width":"140px"},"onUpdate:modelValue":e[1]||(e[1]=s=>v.value=s)},[...e[5]||(e[5]=[t("option",{value:"all"},"All",-1),t("option",{value:"draft"},"Draft",-1),t("option",{value:"issued"},"Issued",-1),t("option",{value:"applied"},"Applied",-1),t("option",{value:"voided"},"Voided",-1)])],512),[[E,v.value]]),t("button",{class:"btn btn-sm btn-outline-secondary",type:"button",onClick:e[2]||(e[2]=s=>m.value=!m.value)},"Sort "+a(m.value?"A→Z":"Z→A"),1),t("button",{class:"btn btn-sm btn-primary",type:"button",onClick:$},"Create")])]),default:I(()=>[t("div",H,[t("table",J,[e[7]||(e[7]=t("thead",null,[t("tr",null,[t("th",null,"No"),t("th",null,"Date"),t("th",null,"Customer"),t("th",null,"Ref Invoice"),t("th",null,"Status"),t("th",{class:"text-end"},"Amount (৳)"),t("th",{class:"text-end"})])],-1)),t("tbody",null,[(_(!0),f(F,null,R(N.value,s=>{var o,i;return _(),f("tr",{key:s.id},[t("td",K,a(s.number),1),t("td",null,a(s.date),1),t("td",null,a((o=S(r).customers.find(l=>l.id===s.customerId))==null?void 0:o.name),1),t("td",null,a(((i=S(r).invoices.find(l=>l.id===s.originalInvoiceId))==null?void 0:i.number)||"—"),1),t("td",O,a(s.status||"draft"),1),t("td",Q,a(A(s).toFixed(2)),1),t("td",W,[t("div",X,[t("button",{class:"btn btn-outline-secondary",onClick:l=>L(s)},"View",8,Y),t("button",{class:"btn btn-outline-secondary",onClick:l=>M(s)},"Edit",8,tt)])])])}),128)),N.value.length===0?(_(),f("tr",et,[...e[6]||(e[6]=[t("td",{colspan:"7",class:"text-muted"},"No credit notes found.",-1)])])):B("",!0)])])]),t("div",st,[t("div",ot,"Page "+a(d.value)+" of "+a(C.value),1),t("div",nt,[t("button",{class:"btn btn-outline-secondary",disabled:d.value<=1,onClick:e[3]||(e[3]=s=>d.value--)},"Prev",8,lt),t("button",{class:"btn btn-outline-secondary",disabled:d.value>=C.value,onClick:e[4]||(e[4]=s=>d.value++)},"Next",8,at)])])]),_:1})])]))}};export{ct as default};
