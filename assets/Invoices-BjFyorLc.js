import{l as Ae,s as r,r as ce,m as Se,k as $e,e as f,x as q,c as i,o as a,a as t,b as G,w as me,f as De,i as h,v as P,g as u,F as y,h as w,u as U,t as l,n as T,y as K,d as j,p as Ce}from"./index-DaYuDLQb.js";import{S as pe}from"./SectionCard-CHGy0F5-.js";import{_ as Me}from"./LineItemsEditor-t_LAr0A9.js";const Ve={class:"row g-3"},Pe={class:"col-lg-6"},Ue={class:"row g-3"},ze={class:"col-md-4"},Re={class:"d-flex gap-2"},je={class:"col-md-4"},Oe={class:"col-md-4"},qe={class:"col-md-6"},Le=["disabled"],Be=["value"],Ee={key:0,class:"row g-2 mt-1"},He={class:"col-7"},Je=["value"],Xe={class:"col-5"},Ye=["value"],Qe={key:1,class:"form-text"},Ge={class:"col-md-6"},Ke=["disabled"],We=["value"],Ze={key:0,class:"row g-2 mt-1"},et={class:"col-7"},tt=["value"],st={class:"col-5"},nt=["value"],ot={key:1,class:"form-text"},lt={class:"col-md-6"},it=["value"],at={class:"col-md-6"},dt=["value"],rt={class:"col-md-6"},ut=["value"],ct={key:0,class:"mt-2"},mt={class:"row g-2"},pt={class:"col-6"},vt={class:"form-text"},bt={class:"col-6 d-flex align-items-end gap-3"},ft={class:"form-check form-switch"},ht={class:"form-check"},xt={class:"form-text"},gt={class:"col-12"},yt={class:"row g-2 align-items-end"},It={class:"col-sm-4"},_t=["disabled"],wt={class:"col-sm-4"},kt=["disabled"],Ft={class:"col-sm-4"},Nt={class:"form-check mt-4"},Tt={class:"col-12"},At={class:"col-12"},St={class:"form-sticky-actions mt-3"},$t={class:"d-flex flex-wrap align-items-center justify-content-between gap-2 p-2"},Dt={class:"d-flex align-items-center gap-2 flex-wrap"},Ct={class:"badge"},Mt={class:"badge"},Vt={class:"badge"},Pt={class:"badge"},Ut={class:"badge"},zt={class:"badge"},Rt={class:"d-flex gap-2"},jt={class:"col-lg-6"},Ot={class:"invoice-header d-flex justify-content-between align-items-start border-bottom pb-2 mb-3"},qt={class:"invoice-brand"},Lt={key:0},Bt={key:1},Et={key:2,class:"text-muted small"},Ht={key:3},Jt={key:4,class:"text-muted small"},Xt={key:0},Yt={key:1},Qt={class:"text-end"},Gt={class:"mb-2 info-block"},Kt={class:"fw-semibold"},Wt={key:0},Zt={key:1,class:"text-muted small"},es={key:2,class:"text-muted small"},ts={key:0},ss={key:1},ns={class:"table table-sm table-invoice align-middle mt-2"},os={class:"fw-medium"},ls={key:0,class:"text-muted small"},is={class:"text-end"},as={class:"text-end"},ds={class:"text-end"},rs={key:0},us={key:1},cs={key:2},ms={class:"text-end"},ps={key:0},vs={class:"mt-2 d-flex"},bs={class:"totals-card"},fs={class:"line"},hs={class:"line"},xs={class:"line"},gs={class:"text-decoration-line-through"},ys={class:"line grand"},Is={key:0,class:"line"},_s={key:1,class:"line"},ws={key:2,class:"line"},ks={key:3,class:"line"},Fs={class:"fw-semibold"},Ns={key:4,class:"muted small mt-1"},Ts={key:0,class:"mt-2"},As={class:"table table-sm mt-1"},Ss={class:"text-end"},$s={key:1,class:"mt-3"},Ds={style:{"white-space":"pre-wrap"}},Cs={key:2,class:"mt-2"},Ms={style:{"white-space":"pre-wrap"}},Rs={__name:"Invoices",setup(Vs){const L=()=>new Date().toISOString().slice(0,10),s=Ae({id:"",number:"",date:L(),dueDate:L(),merchantId:"",merchantAddressId:"",merchantContactId:"",customerId:"",customerAddressId:"",customerContactId:"",paymentTermId:r.settings?.invoice?.defaultPaymentTermId||"",termsTemplateId:r.settings?.invoice?.defaultTermsTemplateId||"",shippingMethodId:r.settings?.invoice?.defaultShippingMethodId||"",shippingAmount:0,shippingCod:!1,shippingFree:!1,shippingFee:0,receivedAmount:0,changeAmount:0,paidInFull:!1,notes:"",items:[]}),ve=ce(null),B=ce(null),W=$e(),be=De();Se(()=>{if(W.params.id){const o=r.invoices.find(e=>e.id===W.params.id);o&&Object.assign(s,JSON.parse(JSON.stringify(o)))}s.merchantId&&!s.merchantAddressId&&ne(),s.customerId&&!s.customerAddressId&&oe()});function E(o){return r.products.find(e=>e.id===o)}const k=f(()=>r.merchants.find(o=>o.id===s.merchantId)),Z=f(()=>k.value?.addresses||[]),ee=f(()=>k.value?.contacts||[]),A=f(()=>Z.value.find(o=>o.id===s.merchantAddressId)),D=f(()=>ee.value.find(o=>o.id===s.merchantContactId)),F=f(()=>r.customers.find(o=>o.id===s.customerId)),te=f(()=>F.value?.addresses||[]),se=f(()=>F.value?.contacts||[]),z=f(()=>te.value.find(o=>o.id===s.customerAddressId)),C=f(()=>se.value.find(o=>o.id===s.customerContactId));function ne(){const o=k.value;o&&(s.merchantAddressId=o.addresses?.find(e=>e.type==="primary")?.id||o.addresses?.[0]?.id||"",s.merchantContactId=o.contacts?.find(e=>e.type==="primary")?.id||o.contacts?.[0]?.id||"")}function oe(){const o=F.value;o&&(s.customerAddressId=o.addresses?.find(e=>e.type==="primary")?.id||o.addresses?.[0]?.id||"",s.customerContactId=o.contacts?.find(e=>e.type==="primary")?.id||o.contacts?.[0]?.id||"")}q(()=>s.merchantId,()=>ne()),q(()=>s.customerId,()=>oe());const le=f(()=>r.termsTemplates.find(o=>o.id===s.termsTemplateId)?.content||""),H=f(()=>r.paymentTerms.find(o=>o.id===s.paymentTermId));function O(o){const e=(Number(o.qty)||0)*(Number(o.unitPrice)||0),n=o.discountType||"none",d=Number(o.discountValue)||0,b=n==="percent"?e*d/100:n==="fixed"?(Number(o.qty)||0)*d:0;return Math.max(0,e-b)}const m=f(()=>{let o=0,e=0;for(const d of s.items){const b=O(d);o+=b;const p=r.taxes.find(c=>c.id===d.taxId);p&&(e+=b*(Number(p.rate)||0)/100)}const n=ie.value;return{sub:o,tax:e,shipping:n,total:o+e+n}});function fe(o){return(o.items||[]).reduce((n,d)=>{const b=(Number(d.qty)||0)*(Number(d.unitPrice)||0),p=d.discountType||"none",c=Number(d.discountValue)||0,x=p==="percent"?b*c/100:p==="fixed"?(Number(d.qty)||0)*c:0,_=Math.max(0,b-x),g=(()=>{const R=r.taxes.find(V=>V.id===d.taxId);return R?_*(Number(R.rate)||0)/100:0})();return n+_+g},0)}const he=f(()=>(r.creditNotes||[]).filter(o=>!!s.id&&o.originalInvoiceId===s.id&&(o.status==="issued"||o.status==="applied"))),M=f(()=>he.value.reduce((o,e)=>o+fe(e),0)),xe=f(()=>{const o=(F.value?.addresses?.[0]?.city||"").toLowerCase();return o?o.includes("dhaka")?"inside_dhaka":"outside_dhaka":"any"}),ge=f(()=>{const o=xe.value;return r.shippingMethods.filter(e=>e.region==="any"||e.region===o)}),I=f(()=>r.shippingMethods.find(o=>o.id===s.shippingMethodId));function J(o){if(!o)return 0;const e=ye.value.sub;return o.freeThreshold&&e>=Number(o.freeThreshold)?0:o.chargeType==="percent"?Number((e*(Number(o.amount)||0)/100).toFixed(2)):Number(o.amount)||0}const ie=f(()=>{if(!I.value)return 0;const e=Number(s.shippingAmount??0);return s.shippingFree?0:e});q(()=>s.shippingMethodId,()=>{const o=I.value;o?(s.shippingAmount=J(o),s.shippingCod=!!o.codAvailable,s.shippingFree=!1):(s.shippingAmount=0,s.shippingCod=!1,s.shippingFree=!1)}),q([()=>s.paidInFull,m],()=>{s.paidInFull&&(s.receivedAmount=Number(m.value.total||0),s.changeAmount=0)});const ye=f(()=>{let o=0,e=0;for(const n of s.items){const d=O(n);o+=d;const b=r.taxes.find(p=>p.id===n.taxId);b&&(e+=d*(Number(b.rate)||0)/100)}return{sub:o,tax:e,total:o+e}});function ae(o){const[e,n,d]=o.split("-").map(Number);return new Date(e,n-1,d)}function de(o){const e=o.getFullYear(),n=String(o.getMonth()+1).padStart(2,"0"),d=String(o.getDate()).padStart(2,"0");return`${e}-${n}-${d}`}function re(o,e){const n=ae(o);return n.setDate(n.getDate()+(Number(e)||0)),de(n)}function Ie(o,e){const n=ae(o),d=n.getFullYear(),b=n.getMonth(),p=new Date(d,b+1,Math.min(Number(e)||1,31)),c=new Date(p.getFullYear(),p.getMonth()+1,0).getDate();return p.setDate(Math.min(Number(e)||1,c)),de(p)}const X=f(()=>{const o=H.value,e=s.date,n=m.value.total;if(!o||!e)return[];const d=(o.schedule||[]).slice().sort((c,x)=>(c.sequence||0)-(x.sequence||0));let b=n;const p=d.map((c,x)=>{const _=c.dateType==="day_of_month"?Ie(e,c.dayOfMonth||1):re(e,c.days||0);let g=0;return c.valueType==="percent"?g=n*(Number(c.valueAmount)||0)/100:g=Number(c.valueAmount)||0,x===d.length-1&&(g=b),b=Math.max(0,b-g),{label:c.description||`Installment ${x+1}`,date:_,amount:g}});return p.length?p:[{label:"Due",date:re(e,0),amount:n}]}),_e=f(()=>{let o=s.date;for(const e of X.value)e.date&&e.date>o&&(o=e.date);return o});function we(){Object.assign(s,{id:"",number:"",date:L(),dueDate:L(),merchantId:"",customerId:"",paymentTermId:r.paymentTerms[0]?.id||"",termsTemplateId:r.termsTemplates[0]?.id||"",notes:"",items:[]})}q([()=>s.date,()=>s.paymentTermId,m],()=>{s.dueDate=_e.value});function ue(){const o=r.settings?.invoice||{prefix:"INV-",nextNumber:1,zeroPad:0},e=String(o.nextNumber).padStart(Number(o.zeroPad)||0,"0");s.number=`${o.prefix||""}${e}`,o.nextNumber=Number(o.nextNumber||1)+1}function ke(){if(!s.merchantId||!s.customerId)return;!s.number&&r.settings?.invoice?.autoNumberOnSave&&ue(),s.id||(s.id=Ce("inv_")),s.shippingFee=ie.value;const o=JSON.parse(JSON.stringify(s)),e=r.invoices.findIndex(n=>n.id===o.id);e===-1?r.invoices.push(o):r.invoices.splice(e,1,o),window.alert("Invoice saved")}function Fe(){if(!B?.value)return;const o=B.value.outerHTML,e=window.open("","_blank","noopener,noreferrer");e&&(e.document.write(`
    <html>
      <head>
        <meta charset="utf-8"/>
        <title>${s.number||"Invoice"}</title>
        <link rel="stylesheet" href="https://bootswatch.com/5/pulse/bootstrap.min.css"/>
        <style>
          @page { size: A4; margin: 10mm; }
          body { background:#fff; -webkit-print-color-adjust: exact; print-color-adjust: exact; margin: 0; }
          .print-area { width: 190mm; margin: 0 auto; padding: 10mm; border: none; }
          .print-area h4 { font-size: 20px; color: #4a148c; }
          .print-area table { font-size: 12px; }
        </style>
      </head>
      <body>
        ${o}
        <script>
          window.addEventListener('load', function(){
            setTimeout(function(){
              try { window.focus(); window.print(); } finally { window.close(); }
            }, 150);
          });
        <\/script>
      </body>
    </html>
  `),e.document.close())}function Ne(){const o=k.value,e=F.value,n=I.value,d=Number((M?.value||0).toFixed(2)),b=Number(m.value.sub.toFixed(2)),p=Number(m.value.tax.toFixed(2)),c=Number(m.value.shipping.toFixed(2)),x=Number(m.value.total.toFixed(2)),_=Number(s.paidInFull?x:Number(s.receivedAmount||0)-Number(s.changeAmount||0)),g=Math.max(0,x-d-_),R=(s.items||[]).map(S=>{const Y=E(S.productId)?.name||S.description||"—",Q=Number(S.qty||0),v=Number(S.unitPrice||0).toFixed(2),$=Number(O(S).toFixed(2));return`
      <div class="row">
        <div class="name">${Y}</div>
        <div class="meta">${Q} x ${v} = ${$.toFixed(2)}</div>
      </div>
    `}).join(""),V=window.open("","_blank","noopener,noreferrer");V&&(V.document.write(`
    <html>
      <head>
        <meta charset="utf-8"/>
        <title>Receipt ${s.number||""}</title>
        <style>
          @page { size: 80mm auto; margin: 0; }
          html, body { padding:0; margin:0; }
          body { -webkit-print-color-adjust: exact; print-color-adjust: exact; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; }
          .receipt { width: 72mm; padding: 4mm 4mm 8mm; }
          .center { text-align:center; }
          .muted { color:#555; }
          .row { margin: 2px 0; }
          .name { font-size: 12px; }
          .meta { font-size: 11px; color:#444; display:flex; justify-content: space-between; }
          .hr { border-top: 1px dashed #000; margin: 6px 0; }
          .totals .line { display:flex; justify-content: space-between; font-size: 12px; }
          .totals .grand { font-weight: 700; }
          .small { font-size: 10px; }
        </style>
      </head>
      <body>
        <div class="receipt">
          <div class="center">
            <div style="font-weight:700">${o?.name||""}</div>
            <div class="small muted">${A?.value?A.value.line1+", "+A.value.city:""}</div>
            <div class="small">Invoice: ${s.number||""}</div>
            <div class="small">Date: ${s.date||""}</div>
          </div>

          <div class="hr"></div>

          <div class="small">Customer: ${e?.name||""}</div>
          ${z?.value?`<div class="small muted">${z.value.city}</div>`:""}

          <div class="hr"></div>

          ${R||'<div class="small muted">No items</div>'}

          <div class="hr"></div>

          <div class="totals">
            <div class="line"><span>Subtotal</span><span>${b.toFixed(2)}</span></div>
            <div class="line"><span>Tax</span><span>${p.toFixed(2)}</span></div>
            ${c>0?`<div class="line"><span>Shipping</span><span>${c.toFixed(2)}</span></div>`:""}
            <div class="line grand"><span>Total</span><span>${x.toFixed(2)}</span></div>
            ${d>0?`<div class="line"><span>Credits</span><span>-${d.toFixed(2)}</span></div>`:""}
            <div class="line"><span>Received</span><span>${_.toFixed(2)}</span></div>
            <div class="line"><span>Balance</span><span>${g.toFixed(2)}</span></div>
          </div>

          ${n?`<div class="small muted" style="margin-top:6px">Shipping via ${n.name}</div>`:""}

          <div class="center small" style="margin-top:8px">— Thank you —</div>
        </div>

        <script>
          window.addEventListener('load', function(){
            setTimeout(function(){
              try { window.focus(); window.print(); } finally { window.close(); }
            }, 150);
          });
        <\/script>
      </body>
    </html>
  `),V.document.close())}async function Te(){if(!B?.value)return;async function o(){return window.pdfMake||(await new Promise((v,$)=>{const N=document.createElement("script");N.src="https://cdn.jsdelivr.net/npm/pdfmake@0.2.10/build/pdfmake.min.js",N.onload=v,N.onerror=$,document.body.appendChild(N)}),await new Promise((v,$)=>{const N=document.createElement("script");N.src="https://cdn.jsdelivr.net/npm/pdfmake@0.2.10/build/vfs_fonts.min.js",N.onload=v,N.onerror=$,document.body.appendChild(N)})),window.pdfMake}await o();const e=k.value,n=F.value,d=A.value,b=z.value,p=D.value,c=C.value,x=X.value.map(v=>[v.label,v.date,{text:v.amount.toFixed(2),alignment:"right"}]),_=Number(s.receivedAmount||0),g=Number(s.changeAmount||0),R=s.paidInFull?m.value.total||0:Math.max(0,_-g),V=Math.max(0,(m.value.total||0)-R),S=(r.termsTemplates.find(v=>v.id===s.termsTemplateId)?.content||"").trim(),Y=[[{text:"Product / Description",bold:!0},{text:"Qty",alignment:"right",bold:!0},{text:"Unit",alignment:"right",bold:!0},{text:"Discount",alignment:"right",bold:!0},{text:"Line",alignment:"right",bold:!0}],...s.items.map(v=>{const $=(v.discountType||"none")==="percent"?`-${Number(v.discountValue||0).toFixed(0)}%`:(v.discountType||"none")==="fixed"?`- ${(Number(v.discountValue||0)*Number(v.qty||0)).toFixed(2)}`:"—";return[E(v.productId)?.name||v.description||"—",{text:String(v.qty||0),alignment:"right"},{text:Number(v.unitPrice||0).toFixed(2),alignment:"right"},{text:$,alignment:"right"},{text:O(v).toFixed(2),alignment:"right"}]})],Q={pageSize:"A4",pageMargins:[28,28,28,28],content:[{columns:[[{text:"Invoice",style:"title"},{text:`No: ${s.number||"(not set)"}`},{text:`Date: ${s.date}`},{text:`Due: ${s.dueDate}`}],[{text:e?.name||"Select Merchant",alignment:"right",bold:!0},{text:d?`${d.line1}, ${d.city}`:"",alignment:"right"},e?.taxId?{text:`VAT/TAX ID: ${e.taxId}`,alignment:"right",color:"#6c757d",fontSize:9}:{},p?{text:`${p.name}${p.email?" · "+p.email:""}${p.phone?" · "+p.phone:""}`,alignment:"right",color:"#6c757d",fontSize:9}:{}]]},{text:" ",margin:[0,6]},{text:"Bill To",bold:!0},{text:n?.name||"Select Customer"},{text:b?`${b.line1}, ${b.city}`:""},n?.taxId?{text:`VAT/TAX ID: ${n.taxId}`,color:"#6c757d",fontSize:9}:{},c?{text:`${c.name}${c.email?" · "+c.email:""}${c.phone?" · "+c.phone:""}`,color:"#6c757d",fontSize:9}:{},{text:" ",margin:[0,6]},{table:{headerRows:1,widths:["*",40,50,55,60],body:Y},layout:"lightHorizontalLines"},{columns:[{text:" "},{width:200,alignment:"right",stack:[{text:`Subtotal: ${m.value.sub.toFixed(2)}`},{text:`Tax: ${m.value.tax.toFixed(2)}`},s.shippingFree?{text:["Shipping: 0.00 ",{text:`(was ${Number(s.shippingAmount||0).toFixed(2)})`,decoration:"lineThrough"}]}:{text:`Shipping: ${(m.value.shipping||0).toFixed(2)}`},{text:`Total: ${m.value.total.toFixed(2)}`,bold:!0},s.paidInFull||_>0?{text:`Received: ${_.toFixed(2)}`}:{},g>0?{text:`Change: ${g.toFixed(2)}`}:{},s.paidInFull||_>0?{text:`Balance Due: ${V.toFixed(2)}`,bold:!0}:{}]}],margin:[0,8,0,0]},...x.length&&!s.paidInFull?[{text:`Payment Schedule — ${H.value?.name||""}`,bold:!0,margin:[0,8,0,4]},{table:{headerRows:1,widths:["*",80,80],body:[[{text:"Installment",bold:!0},{text:"Date",bold:!0},{text:"Amount",alignment:"right",bold:!0}],...x]},layout:"lightHorizontalLines"}]:[],...S?[{text:"Terms",bold:!0,margin:[0,12,0,4]},{text:S,fontSize:9}]:[]],footer:(v,$)=>({margin:[28,8,28,16],fontSize:9,text:r.settings?.invoice?.footerText||""}),styles:{title:{fontSize:18,color:"#4a148c",bold:!0}},defaultStyle:{fontSize:10}};window.pdfMake.createPdf(Q).download(`invoice_${s.number||"draft"}.pdf`)}return(o,e)=>(a(),i("div",Ve,[t("div",Pe,[G(pe,{title:"Create Invoice"},{default:me(()=>[t("div",Ue,[e[44]||(e[44]=t("div",{class:"col-12"},[t("div",{class:"subsection-title"},"Invoice Info")],-1)),t("div",ze,[e[20]||(e[20]=t("label",{class:"form-label"},"Invoice Number",-1)),t("div",Re,[h(t("input",{class:"form-control","onUpdate:modelValue":e[0]||(e[0]=n=>s.number=n),placeholder:"e.g., INV-0001"},null,512),[[P,s.number]]),t("button",{class:"btn btn-outline-secondary",type:"button",onClick:ue},"Auto")])]),t("div",je,[e[21]||(e[21]=t("label",{class:"form-label"},"Date",-1)),h(t("input",{class:"form-control",type:"date","onUpdate:modelValue":e[1]||(e[1]=n=>s.date=n)},null,512),[[P,s.date]])]),t("div",Oe,[e[22]||(e[22]=t("label",{class:"form-label"},"Due Date",-1)),h(t("input",{class:"form-control",type:"date","onUpdate:modelValue":e[2]||(e[2]=n=>s.dueDate=n)},null,512),[[P,s.dueDate]])]),e[45]||(e[45]=t("div",{class:"col-12"},[t("div",{class:"subsection-title mt-1"},"Parties")],-1)),t("div",qe,[e[26]||(e[26]=t("label",{class:"form-label"},"Merchant",-1)),h(t("select",{class:"form-select","onUpdate:modelValue":e[3]||(e[3]=n=>s.merchantId=n),disabled:!!s.id},[e[23]||(e[23]=t("option",{value:""},"Select a merchant",-1)),(a(!0),i(y,null,w(U(r).merchants,n=>(a(),i("option",{key:n.id,value:n.id},l(n.name),9,Be))),128))],8,Le),[[T,s.merchantId]]),k.value?(a(),i("div",Ee,[t("div",He,[e[24]||(e[24]=t("label",{class:"form-label small mb-1"},"Address",-1)),h(t("select",{class:"form-select form-select-sm","onUpdate:modelValue":e[4]||(e[4]=n=>s.merchantAddressId=n)},[(a(!0),i(y,null,w(Z.value,n=>(a(),i("option",{key:n.id,value:n.id},l(n.type)+" — "+l(n.city),9,Je))),128))],512),[[T,s.merchantAddressId]])]),t("div",Xe,[e[25]||(e[25]=t("label",{class:"form-label small mb-1"},"Contact",-1)),h(t("select",{class:"form-select form-select-sm","onUpdate:modelValue":e[5]||(e[5]=n=>s.merchantContactId=n)},[(a(!0),i(y,null,w(ee.value,n=>(a(),i("option",{key:n.id,value:n.id},l(n.type)+" — "+l(n.name),9,Ye))),128))],512),[[T,s.merchantContactId]])])])):u("",!0),s.id?(a(),i("div",Qe,"Locked for existing invoice")):u("",!0)]),t("div",Ge,[e[30]||(e[30]=t("label",{class:"form-label"},"Customer",-1)),h(t("select",{class:"form-select","onUpdate:modelValue":e[6]||(e[6]=n=>s.customerId=n),disabled:!!s.id},[e[27]||(e[27]=t("option",{value:""},"Select a customer",-1)),(a(!0),i(y,null,w(U(r).customers,n=>(a(),i("option",{key:n.id,value:n.id},l(n.name),9,We))),128))],8,Ke),[[T,s.customerId]]),F.value?(a(),i("div",Ze,[t("div",et,[e[28]||(e[28]=t("label",{class:"form-label small mb-1"},"Address",-1)),h(t("select",{class:"form-select form-select-sm","onUpdate:modelValue":e[7]||(e[7]=n=>s.customerAddressId=n)},[(a(!0),i(y,null,w(te.value,n=>(a(),i("option",{key:n.id,value:n.id},l(n.type)+" — "+l(n.city),9,tt))),128))],512),[[T,s.customerAddressId]])]),t("div",st,[e[29]||(e[29]=t("label",{class:"form-label small mb-1"},"Contact",-1)),h(t("select",{class:"form-select form-select-sm","onUpdate:modelValue":e[8]||(e[8]=n=>s.customerContactId=n)},[(a(!0),i(y,null,w(se.value,n=>(a(),i("option",{key:n.id,value:n.id},l(n.type)+" — "+l(n.name),9,nt))),128))],512),[[T,s.customerContactId]])])])):u("",!0),s.id?(a(),i("div",ot,"Locked for existing invoice")):u("",!0)]),t("div",lt,[e[32]||(e[32]=t("label",{class:"form-label"},"Payment Terms",-1)),h(t("select",{class:"form-select","onUpdate:modelValue":e[9]||(e[9]=n=>s.paymentTermId=n)},[e[31]||(e[31]=t("option",{value:""},"—",-1)),(a(!0),i(y,null,w(U(r).paymentTerms,n=>(a(),i("option",{key:n.id,value:n.id},l(n.name),9,it))),128))],512),[[T,s.paymentTermId]])]),t("div",at,[e[34]||(e[34]=t("label",{class:"form-label"},"Terms Template",-1)),h(t("select",{class:"form-select","onUpdate:modelValue":e[10]||(e[10]=n=>s.termsTemplateId=n)},[e[33]||(e[33]=t("option",{value:""},"—",-1)),(a(!0),i(y,null,w(U(r).termsTemplates,n=>(a(),i("option",{key:n.id,value:n.id},l(n.name),9,dt))),128))],512),[[T,s.termsTemplateId]])]),e[46]||(e[46]=t("div",{class:"col-12"},[t("div",{class:"subsection-title mt-2"},"Shipping")],-1)),t("div",rt,[e[39]||(e[39]=t("label",{class:"form-label"},"Shipping Method",-1)),h(t("select",{class:"form-select","onUpdate:modelValue":e[11]||(e[11]=n=>s.shippingMethodId=n)},[e[35]||(e[35]=t("option",{value:""},"Select shipping",-1)),(a(!0),i(y,null,w(ge.value,n=>(a(),i("option",{key:n.id,value:n.id},l(n.name)+" — ৳"+l(J(n).toFixed(2))+l(n.chargeType==="percent"?" ("+Number(n.amount)+"%)":"")+l(n.freeThreshold?" · free over ৳"+Number(n.freeThreshold).toFixed(0):""),9,ut))),128))],512),[[T,s.shippingMethodId]]),I.value?(a(),i("div",ct,[t("div",mt,[t("div",pt,[e[36]||(e[36]=t("label",{class:"form-label"},"Amount (৳)",-1)),h(t("input",{class:"form-control form-control-sm text-end",type:"number",min:"0",step:"0.01","onUpdate:modelValue":e[12]||(e[12]=n=>s.shippingAmount=n)},null,512),[[P,s.shippingAmount,void 0,{number:!0}]]),t("div",vt,"Auto: "+l(J(I.value).toFixed(2)),1)]),t("div",bt,[t("div",ft,[h(t("input",{class:"form-check-input",type:"checkbox",id:"codSwitch","onUpdate:modelValue":e[13]||(e[13]=n=>s.shippingCod=n)},null,512),[[K,s.shippingCod]]),e[37]||(e[37]=t("label",{class:"form-check-label",for:"codSwitch"},"COD",-1))]),t("div",ht,[h(t("input",{class:"form-check-input",type:"checkbox",id:"freeShip","onUpdate:modelValue":e[14]||(e[14]=n=>s.shippingFree=n)},null,512),[[K,s.shippingFree]]),e[38]||(e[38]=t("label",{class:"form-check-label",for:"freeShip"},"Shipping free",-1))])])]),t("div",xt," Estimated "+l(I.value?.leadDaysMin)+"–"+l(I.value?.leadDaysMax)+" days. Provider COD default: "+l(I.value?.codAvailable?"Yes":"No")+". ",1)])):u("",!0)]),e[47]||(e[47]=t("div",{class:"col-12"},[t("div",{class:"subsection-title mt-2"},"Payment")],-1)),t("div",gt,[t("div",yt,[t("div",It,[e[40]||(e[40]=t("label",{class:"form-label"},"Received Amount (৳)",-1)),h(t("input",{class:"form-control form-control-sm text-end",type:"number",min:"0",step:"0.01","onUpdate:modelValue":e[15]||(e[15]=n=>s.receivedAmount=n),disabled:s.paidInFull},null,8,_t),[[P,s.receivedAmount,void 0,{number:!0}]])]),t("div",wt,[e[41]||(e[41]=t("label",{class:"form-label"},"Change (৳)",-1)),h(t("input",{class:"form-control form-control-sm text-end",type:"number",min:"0",step:"0.01","onUpdate:modelValue":e[16]||(e[16]=n=>s.changeAmount=n),disabled:s.paidInFull},null,8,kt),[[P,s.changeAmount,void 0,{number:!0}]])]),t("div",Ft,[t("div",Nt,[h(t("input",{class:"form-check-input",type:"checkbox",id:"paidFull","onUpdate:modelValue":e[17]||(e[17]=n=>s.paidInFull=n)},null,512),[[K,s.paidInFull]]),e[42]||(e[42]=t("label",{class:"form-check-label",for:"paidFull"},"Mark as Fully Paid",-1))])])])]),e[48]||(e[48]=t("div",{class:"col-12"},[t("div",{class:"subsection-title mt-2"},"Items & Notes")],-1)),t("div",Tt,[G(Me,{ref_key:"itemsEditor",ref:ve,items:s.items,products:U(r).products,taxes:U(r).taxes,onUpdate:()=>{}},null,8,["items","products","taxes"])]),t("div",At,[e[43]||(e[43]=t("label",{class:"form-label"},"Notes",-1)),h(t("textarea",{class:"form-control",rows:"2","onUpdate:modelValue":e[18]||(e[18]=n=>s.notes=n),placeholder:"Optional notes to show on invoice"},null,512),[[P,s.notes]])])]),t("div",St,[t("div",$t,[t("div",Dt,[t("span",Ct,"Subtotal: "+l(m.value.sub.toFixed(2)),1),t("span",Mt,"Tax: "+l(m.value.tax.toFixed(2)),1),t("span",Vt,"Shipping: "+l((m.value.shipping||0).toFixed(2)),1),t("span",Pt,"Credits: -"+l((M.value||0).toFixed(2)),1),t("span",Ut,"Total: "+l(m.value.total.toFixed(2)),1),t("span",zt,"Net: "+l((m.value.total-(M.value||0)).toFixed(2)),1)]),t("div",Rt,[t("button",{class:"btn btn-outline-secondary",type:"button",onClick:we},"Reset"),t("button",{class:"btn btn-outline-secondary",type:"button",onClick:Fe},"Print"),t("button",{class:"btn btn-outline-secondary",type:"button",onClick:Ne},"Receipt"),t("button",{class:"btn btn-primary",type:"button",onClick:Te},"Download PDF"),s.id?(a(),i("button",{key:0,class:"btn btn-outline-secondary",type:"button",onClick:e[19]||(e[19]=()=>U(be).push(`/credit-notes/new?invoiceId=${s.id}`))},"New Credit Note")):u("",!0),t("button",{class:"btn btn-success",type:"button",onClick:ke},"Save")])])])]),_:1})]),t("div",jt,[G(pe,{title:"Preview"},{default:me(()=>[t("div",{class:"print-area",ref_key:"printRef",ref:B},[t("div",Ot,[t("div",qt,[t("strong",null,l(k.value?.name||"Select Merchant"),1),e[49]||(e[49]=t("br",null,null,-1)),A.value?(a(),i("span",Lt,l(A.value.line1)+", "+l(A.value.city),1)):u("",!0),A.value?(a(),i("br",Bt)):u("",!0),k.value?.taxId?(a(),i("span",Et,"VAT/TAX ID: "+l(k.value.taxId),1)):u("",!0),k.value?.taxId?(a(),i("br",Ht)):u("",!0),D.value?(a(),i("span",Jt,[j(l(D.value.name),1),D.value.email?(a(),i("span",Xt," · "+l(D.value.email),1)):u("",!0),D.value.phone?(a(),i("span",Yt," · "+l(D.value.phone),1)):u("",!0)])):u("",!0)]),t("div",Qt,[e[53]||(e[53]=t("h4",{class:"mb-1"},"Invoice",-1)),t("div",null,[e[50]||(e[50]=t("span",{class:"text-muted"},"No:",-1)),j(" "+l(s.number||"(not set)"),1)]),t("div",null,[e[51]||(e[51]=t("span",{class:"text-muted"},"Date:",-1)),j(" "+l(s.date),1)]),t("div",null,[e[52]||(e[52]=t("span",{class:"text-muted"},"Due:",-1)),j(" "+l(s.dueDate),1)])])]),t("div",Gt,[e[54]||(e[54]=t("div",{class:"text-uppercase muted-label"},"Bill To",-1)),t("div",Kt,l(F.value?.name||"Select Customer"),1),z.value?(a(),i("div",Wt,l(z.value.line1)+", "+l(z.value.city),1)):u("",!0),F.value?.taxId?(a(),i("div",Zt,"VAT/TAX ID: "+l(F.value.taxId),1)):u("",!0),C.value?(a(),i("div",es,[j(l(C.value.name),1),C.value.email?(a(),i("span",ts," · "+l(C.value.email),1)):u("",!0),C.value.phone?(a(),i("span",ss," · "+l(C.value.phone),1)):u("",!0)])):u("",!0)]),t("table",ns,[e[56]||(e[56]=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"Product / Description"),t("th",{class:"text-end"},"Qty"),t("th",{class:"text-end"},"Unit"),t("th",{class:"text-end"},"Discount"),t("th",{class:"text-end"},"Line")])],-1)),t("tbody",null,[(a(!0),i(y,null,w(s.items,n=>(a(),i("tr",{key:n.id},[t("td",null,[t("div",os,l(E(n.productId)?.name||n.description||"—"),1),n.description&&E(n.productId)?.name!==n.description?(a(),i("div",ls,l(n.description),1)):u("",!0)]),t("td",is,l(n.qty),1),t("td",as,l(Number(n.unitPrice||0).toFixed(2)),1),t("td",ds,[(n.discountType||"none")==="percent"?(a(),i("span",rs,"-"+l(Number(n.discountValue||0).toFixed(0))+"%",1)):(n.discountType||"none")==="fixed"?(a(),i("span",us,"-"+l((Number(n.discountValue||0)*Number(n.qty||0)).toFixed(2)),1)):(a(),i("span",cs,"—"))]),t("td",ms,l(O(n).toFixed(2)),1)]))),128)),s.items.length===0?(a(),i("tr",ps,[...e[55]||(e[55]=[t("td",{colspan:"5",class:"text-muted"},"No items",-1)])])):u("",!0)])]),t("div",vs,[e[66]||(e[66]=t("div",{class:"flex-grow-1"},null,-1)),t("div",bs,[t("div",fs,[e[57]||(e[57]=t("span",null,"Subtotal",-1)),t("span",null,l(m.value.sub.toFixed(2)),1)]),t("div",hs,[e[58]||(e[58]=t("span",null,"Tax",-1)),t("span",null,l(m.value.tax.toFixed(2)),1)]),t("div",xs,[e[60]||(e[60]=t("span",null,"Shipping",-1)),t("span",null,[s.shippingFree?(a(),i(y,{key:0},[t("span",gs,l(Number(s.shippingAmount||0).toFixed(2)),1),e[59]||(e[59]=t("span",{class:"ms-1"},"0.00",-1))],64)):(a(),i(y,{key:1},[j(l((m.value.shipping||0).toFixed(2)),1)],64))])]),t("div",ys,[e[61]||(e[61]=t("span",null,"Total",-1)),t("span",null,l(m.value.total.toFixed(2)),1)]),M.value>0?(a(),i("div",Is,[e[62]||(e[62]=t("span",null,"Credits",-1)),t("span",null,"-"+l(M.value.toFixed(2)),1)])):u("",!0),s.paidInFull||Number(s.receivedAmount||0)>0?(a(),i("div",_s,[e[63]||(e[63]=t("span",null,"Received",-1)),t("span",null,l(Number(s.receivedAmount||0).toFixed(2)),1)])):u("",!0),Number(s.changeAmount||0)>0?(a(),i("div",ws,[e[64]||(e[64]=t("span",null,"Change",-1)),t("span",null,l(Number(s.changeAmount||0).toFixed(2)),1)])):u("",!0),s.paidInFull||Number(s.receivedAmount||0)>0||M.value>0?(a(),i("div",ks,[e[65]||(e[65]=t("span",{class:"fw-semibold"},"Balance Due",-1)),t("span",Fs,l(Math.max(0,m.value.total-M.value-(s.paidInFull?m.value.total:Math.max(0,Number(s.receivedAmount||0)-Number(s.changeAmount||0)))).toFixed(2)),1)])):u("",!0),I.value?(a(),i("div",Ns," Shipping via "+l(I.value?.name)+" ("+l(I.value?.leadDaysMin)+"–"+l(I.value?.leadDaysMax)+" days) ",1)):u("",!0)])]),H.value&&!s.paidInFull?(a(),i("div",Ts,[t("strong",null,"Payment Schedule — "+l(H.value?.name),1),t("table",As,[e[67]||(e[67]=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"Installment"),t("th",null,"Date"),t("th",{class:"text-end"},"Amount")])],-1)),t("tbody",null,[(a(!0),i(y,null,w(X.value,n=>(a(),i("tr",{key:n.label+n.date},[t("td",null,l(n.label),1),t("td",null,l(n.date),1),t("td",Ss,l(n.amount.toFixed(2)),1)]))),128))])])])):u("",!0),le.value?(a(),i("div",$s,[e[68]||(e[68]=t("strong",null,"Terms",-1)),t("div",Ds,l(le.value),1)])):u("",!0),s.notes?(a(),i("div",Cs,[e[69]||(e[69]=t("strong",null,"Notes",-1)),t("div",Ms,l(s.notes),1)])):u("",!0)],512)]),_:1})])]))}};export{Rs as default};
